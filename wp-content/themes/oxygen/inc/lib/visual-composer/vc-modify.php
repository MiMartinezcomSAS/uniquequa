<?php
/**
 *	This will add better support for Visual Composer in Oxygen Theme
 *	
 *	Laborator.co
 *	www.laborator.co 
 */

$lvcm_min_version = '4.3.0';
$lvcm_max_version = '4.3.5';

$plugin_dir = 'js_composer';

$files = array(
	'include/classes/core/class-wpb-map.php' => 'PD9waHANCi8qKg0KICogV1BCYWtlcnkgVmlzdWFsIENvbXBvc2VyIE1haW4gbWFuYWdlci4NCiAqDQogKiBAcGFja2FnZSBXUEJha2VyeVZpc3VhbENvbXBvc2VyDQogKiBAc2luY2UgICA0LjINCiAqLw0KLyoqDQogKiBWYyBtYXBwZXIgbmV3IGNsYXNzLg0KICoNCiAqIFRoaXMgY2xhc3MgbWFwcyBzaG9ydGNvZGVzIHNldHRpbmdzIHRvIFZDIGVkaXRvcnMuIFlvdSBjYW4gbWFuYWdlIGFkZCBuZXcgc2hvcnRjb2RlcyBvciBtYW5hZ2UgZGVmYXVsdCBzaG9ydGNvZGVzDQogKiBtYXBwZWQgaW4gY29uZmlnL21hcC5waHAuIEZvciBkZXZlbG9wZXJzIGl0IGlzIHBvc3NpYmxlIHRvIHVzZSBBUEkgZnVuY3Rpb25zIHRvIGFkZCB1cGRhdGUgc2V0dGluZ3MgYXR0cmlidXRlcy4NCiAqDQogKiBAc2VlIGNvbmZpZy9tYXAucGhwDQogKiBAc2VlIGluY2x1ZGUvaGVscGVycy9oZWxwZXJzX2FwaS5waHANCiAqIEBzaW5jZSAzLjENCiAqDQogKi8NCmNsYXNzIFdQQk1hcCB7DQoJcHJvdGVjdGVkIHN0YXRpYyAkc2MgPSBBcnJheSgpOw0KCXByb3RlY3RlZCBzdGF0aWMgJGNhdGVnb3JpZXMgPSBBcnJheSgpOw0KCXByb3RlY3RlZCBzdGF0aWMgJHVzZXJfc2MgPSBmYWxzZTsNCglwcm90ZWN0ZWQgc3RhdGljICR1c2VyX3NvcnRlZF9zYyA9IGZhbHNlOw0KCXByb3RlY3RlZCBzdGF0aWMgJHVzZXJfY2F0ZWdvcmllcyA9IGZhbHNlOw0KCXByb3RlY3RlZCBzdGF0aWMgJHNldHRpbmdzLCAkdXNlcl9yb2xlOw0KCXByb3RlY3RlZCBzdGF0aWMgJHRhZ3NfcmVnZXhwOw0KCXByb3RlY3RlZCBzdGF0aWMgJGlzX2luaXQgPSBmYWxzZTsNCg0KCS8qKg0KCSAqIFNldCBpbml0IHN0YXR1cyBmcm8gV1BNYXAuDQoJICoNCgkgKiBpZiAkaXNfaW5pdCBpcyBGQUxTRSwgdGhlbiBhbGwgYWN0aXZpdHkgbGlrZSBhZGQsIHVwZGF0ZSBhbmQgZGVsZXRlIGZvciBzaG9ydGNvZGVzIGF0dHJpYnV0ZXMgd2lsbCBiZSBob2xkIGluDQoJICogdGhlIGxpc3Qgb2YgYWN0aXZpdHkgYW5kIHdpbGwgYmUgZXhlY3V0ZWQgYWZ0ZXIgaW5pdGlhbGl6YXRpb24uDQoJICoNCgkgKiBAc2VlIFZjX01hcHBlcjo6aW5peS4NCgkgKiBAc3RhdGljDQoJICogQHBhcmFtIGJvb2wgJHZhbHVlDQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBzZXRJbml0KCAkdmFsdWUgPSB0cnVlICkgew0KCQlzZWxmOjokaXNfaW5pdCA9ICR2YWx1ZTsNCgl9DQoNCgkvKioNCgkgKiBHZXRzIHVzZXIgcm9sZSBhbmQgYWNjZXNzIHJ1bGVzIGZvciBjdXJyZW50IHVzZXIuDQoJICoNCgkgKiBAc3RhdGljDQoJICogQHJldHVybiBtaXhlZA0KCSAqLw0KCXByb3RlY3RlZCBzdGF0aWMgZnVuY3Rpb24gZ2V0U2V0dGluZ3MoKSB7DQoJCWdsb2JhbCAkY3VycmVudF91c2VyOw0KDQoJCWlmICggc2VsZjo6JHNldHRpbmdzID09PSBudWxsICkgew0KCQkJaWYgKCBmdW5jdGlvbl9leGlzdHMoICdnZXRfY3VycmVudHVzZXJpbmZvJyApICkgew0KCQkJCWdldF9jdXJyZW50dXNlcmluZm8oKTsNCgkJCQkvKiogQHZhciAkc2V0dGluZ3MgLSBnZXQgdXNlIGdyb3VwIGFjY2VzcyBydWxlcyAqLw0KCQkJCWlmICggISBlbXB0eSggJGN1cnJlbnRfdXNlci0+cm9sZXMgKSApDQoJCQkJCXNlbGY6OiR1c2VyX3JvbGUgPSAkY3VycmVudF91c2VyLT5yb2xlc1swXTsNCgkJCQllbHNlDQoJCQkJCXNlbGY6OiR1c2VyX3JvbGUgPSAnYXV0aG9yJzsNCgkJCX0gZWxzZSB7DQoJCQkJc2VsZjo6JHVzZXJfcm9sZSA9ICdhdXRob3InOw0KCQkJfQ0KCQkJc2VsZjo6JHNldHRpbmdzID0gdmNfc2V0dGluZ3MoKS0+Z2V0KCAnZ3JvdXBzX2FjY2Vzc19ydWxlcycgKTsNCgkJfQ0KDQoJCXJldHVybiBzZWxmOjokc2V0dGluZ3M7DQoJfQ0KDQoJLyoqDQoJICogQ2hlY2sgaXMgc2hvcnRjb2RlIHdpdGggYSB0YWcgbWFwcGVkIHRvIFZDLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqIEBwYXJhbSAkdGFnIC0gc2hvcnRjb2RlIHRhZy4NCgkgKiBAcmV0dXJuIGJvb2wNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGV4aXN0cyggJHRhZyApIHsNCgkJcmV0dXJuIChib29sZWFuKWlzc2V0KCBzZWxmOjokc2NbJHRhZ10gKTsNCgl9DQoNCgkvKioNCgkgKiBNYXAgc2hvcnRjb2RlIHRvIFZDLg0KCSAqDQoJICogVGhpcyBtZXRob2QgbWFwcyBzaG9ydGNvZGUgdG8gVkMuDQoJICogWW91IG5lZWQgdG8gc2hvcnRjb2RlJ3MgdGFnIGFuZCAgc2V0dGluZ3MgdG8gbWFwIGNvcnJlY3RseS4NCgkgKiBEZWZhdWx0IHNob3J0Y29kZXMgYXJlIG1hcHBlZCBpbiBjb25maWcvbWFwLnBocCBmaWxlLg0KCSAqIFRoZSBiZXN0IHdheSBpcyB0byBjYWxsIHRoaXMgbWV0aG9kIHdpdGggImluaXQiIGFjdGlvbiBjYWxsYmFjayBmdW5jdGlvbiBvZiBXUC4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcGFyYW0gJHRhZw0KCSAqIEBwYXJhbSAkYXR0cmlidXRlcw0KCSAqIEByZXR1cm4gYm9vbA0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbWFwKCAkdGFnLCAkYXR0cmlidXRlcyApIHsNCgkJaWYgKCAhIHNlbGY6OiRpc19pbml0ICkgew0KCQkJdmNfbWFwcGVyKCktPmFkZEFjdGl2aXR5KA0KCQkJCSdtYXBwZXInLCAnbWFwJywgYXJyYXkoDQoJCQkJCSd0YWcnID0+ICR0YWcsDQoJCQkJCSdhdHRyaWJ1dGVzJyA9PiAkYXR0cmlidXRlcw0KCQkJCSkNCgkJCSk7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCgkJaWYgKCBlbXB0eSggJGF0dHJpYnV0ZXNbJ25hbWUnXSApICkgew0KCQkJdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBuYW1lIGZvciBzaG9ydGNvZGU6JXMuIE5hbWUgcmVxdWlyZWQiLCAianNfY29tcG9zZXIiICksICR0YWcgKSApOw0KCQl9IGVsc2VpZiAoIGVtcHR5KCAkYXR0cmlidXRlc1snYmFzZSddICkgKSB7DQoJCQl0cmlnZ2VyX2Vycm9yKCBzcHJpbnRmKCBfXyggIldyb25nIGJhc2UgZm9yIHNob3J0Y29kZTolcy4gQmFzZSByZXF1aXJlZCIsICJqc19jb21wb3NlciIgKSwgJHRhZyApICk7DQoJCX0gZWxzZSB7DQoJCQkJDQoJCQkjIHN0YXJ0OiBtb2RpZmllZCBieSBBcmxpbmQgTnVzaGkNCgkJCSRhdHRyaWJ1dGVzID0gYXBwbHlfZmlsdGVycygnbGFiX3ZjX21hcF9hdHRycycsICRhdHRyaWJ1dGVzKTsNCgkJCQ0KCQkJaWYoICEgJGF0dHJpYnV0ZXMgJiYgaXNzZXQoc2VsZjo6JHNjWyRuYW1lXSkpDQoJCQl7DQoJCQkJdW5zZXQoc2VsZjo6JHNjWyRuYW1lXSk7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KCQkJIyBlbmQ6IG1vZGlmaWVkIGJ5IEFybGluZCBOdXNoaQ0KCQkJDQoJCQlzZWxmOjokc2NbJHRhZ10gPSAkYXR0cmlidXRlczsNCgkJCXNlbGY6OiRzY1skdGFnXVsncGFyYW1zJ10gPSBBcnJheSgpOw0KCQkJaWYgKCAhIGVtcHR5KCAkYXR0cmlidXRlc1sncGFyYW1zJ10gKSApIHsNCgkJCQlmb3JlYWNoICggJGF0dHJpYnV0ZXNbJ3BhcmFtcyddIGFzICRhdHRyaWJ1dGUgKSB7DQoJCQkJCSRhdHRyaWJ1dGUgPSBhcHBseV9maWx0ZXJzKCd2Y19tYXBwZXJfYXR0cmlidXRlJywgJGF0dHJpYnV0ZSwgJHRhZyk7DQoJCQkJCSRhdHRyaWJ1dGUgPSBhcHBseV9maWx0ZXJzKCd2Y19tYXBwZXJfYXR0cmlidXRlXycuJGF0dHJpYnV0ZVsndHlwZSddLCAkYXR0cmlidXRlLCAkdGFnKTsNCgkJCQkJc2VsZjo6JHNjWyR0YWddWydwYXJhbXMnXVtdID0gJGF0dHJpYnV0ZTsNCgkJCQl9DQoJCQl9DQoJCQl2aXN1YWxfY29tcG9zZXIoKS0+YWRkU2hvcnRDb2RlKCBzZWxmOjokc2NbJHRhZ10gKTsNCgkJfQ0KCX0NCg0KCS8qKg0KCSAqIEdlbmVyYXRlcyBsaXN0IG9mIHNob3J0Y29kZXMgdGFraW5nIGludG8gYWNjb3VudCB0aGUgYWNjZXNzIHJ1bGVzIGZvciBzaG9ydGNvZGVzIGZyb20gVkMgU2V0dGluZ3MgcGFnZS4NCgkgKg0KCSAqIFRoaXMgbWV0aG9kIHBhcnNlcyB0aGUgbGlzdCBvZiBtYXBwZWQgc2hvcnRjb2RlcyBhbmQgY3JlYXRlcyBjYXRlZ29yaWVzIGxpc3QgZm9yIHVzZXJzLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqIEBwYXJhbSBib29sICRmb3JjZSAtIGZvcmNlIGRhdGEgZ2VuZXJhdGlvbiBldmVuIGRhdGEgYWxyZWFkeSBnZW5lcmF0ZWQuDQoJICovDQoJcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBnZW5lcmF0ZVVzZXJEYXRhKCAkZm9yY2UgPSBmYWxzZSApIHsNCgkJaWYgKCAhICRmb3JjZSAmJiBzZWxmOjokdXNlcl9zYyAhPT0gZmFsc2UgJiYgc2VsZjo6JHVzZXJfY2F0ZWdvcmllcyAhPT0gZmFsc2UgKSByZXR1cm47DQoNCgkJJHNldHRpbmdzID0gc2VsZjo6Z2V0U2V0dGluZ3MoKTsNCgkJc2VsZjo6JHVzZXJfc2MgPSBzZWxmOjokdXNlcl9jYXRlZ29yaWVzID0gc2VsZjo6JHVzZXJfc29ydGVkX3NjID0gYXJyYXkoKTsNCgkJZm9yZWFjaCAoIHNlbGY6OiRzYyBhcyAkbmFtZSA9PiAkdmFsdWVzICkgew0KCQkJaWYgKCBpbl9hcnJheSggJG5hbWUsIGFycmF5KCAndmNfY29sdW1uJywgJ3ZjX3JvdycsICd2Y19yb3dfaW5uZXInLCAndmNfY29sdW1uX2lubmVyJyApICkgfHwgISBpc3NldCggJHNldHRpbmdzW3NlbGY6OiR1c2VyX3JvbGVdWydzaG9ydGNvZGVzJ10gKQ0KCQkJICB8fCAoIGlzc2V0KCAkc2V0dGluZ3Nbc2VsZjo6JHVzZXJfcm9sZV1bJ3Nob3J0Y29kZXMnXVskbmFtZV0gKSAmJiAoaW50KSRzZXR0aW5nc1tzZWxmOjokdXNlcl9yb2xlXVsnc2hvcnRjb2RlcyddWyRuYW1lXSA9PSAxICkNCgkJCSkgew0KCQkJCWlmICggISBpc3NldCggJHZhbHVlc1snY29udGVudF9lbGVtZW50J10gKSB8fCAkdmFsdWVzWydjb250ZW50X2VsZW1lbnQnXSA9PT0gdHJ1ZSApIHsNCgkJCQkJJGNhdGVnb3JpZXMgPSBpc3NldCggJHZhbHVlc1snY2F0ZWdvcnknXSApID8gJHZhbHVlc1snY2F0ZWdvcnknXSA6ICdfb3RoZXJfY2F0ZWdvcnlfJzsNCgkJCQkJJHZhbHVlc1snX2NhdGVnb3J5X2lkcyddID0gYXJyYXkoKTsNCgkJCQkJaWYgKCBpc19hcnJheSggJGNhdGVnb3JpZXMgKSApIHsNCgkJCQkJCWZvcmVhY2ggKCAkY2F0ZWdvcmllcyBhcyAkYyApIHsNCgkJCQkJCQlpZiAoIGFycmF5X3NlYXJjaCggJGMsIHNlbGY6OiR1c2VyX2NhdGVnb3JpZXMgKSA9PT0gZmFsc2UgKSBzZWxmOjokdXNlcl9jYXRlZ29yaWVzW10gPSAkYzsNCgkJCQkJCQkkdmFsdWVzWydfY2F0ZWdvcnlfaWRzJ11bXSA9IG1kNSggJGMgKTsgLy8gYXJyYXlfc2VhcmNoKCRjYXRlZ29yeSwgc2VsZjo6JGNhdGVnb3JpZXMpOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJaWYgKCBhcnJheV9zZWFyY2goICRjYXRlZ29yaWVzLCBzZWxmOjokdXNlcl9jYXRlZ29yaWVzICkgPT09IGZhbHNlICkgc2VsZjo6JHVzZXJfY2F0ZWdvcmllc1tdID0gJGNhdGVnb3JpZXM7DQoJCQkJCQkkdmFsdWVzWydfY2F0ZWdvcnlfaWRzJ11bXSA9IG1kNSggJGNhdGVnb3JpZXMgKTsgLy8gYXJyYXlfc2VhcmNoKCRjYXRlZ29yeSwgc2VsZjo6JGNhdGVnb3JpZXMpOw0KCQkJCQl9DQoNCgkJCQl9DQoJCQkJc2VsZjo6JHVzZXJfc2NbJG5hbWVdID0gJHZhbHVlczsNCgkJCQlzZWxmOjokdXNlcl9zb3J0ZWRfc2NbXSA9ICR2YWx1ZXM7DQoJCQl9DQoNCgkJfQ0KCQlAdXNvcnQoIHNlbGY6OiR1c2VyX3NvcnRlZF9zYywgYXJyYXkoICJXUEJNYXAiLCAic29ydCIgKSApOw0KCX0NCg0KCS8qKg0KCSAqIEdldCBtYXBwZWQgc2hvcnRjb2RlIHNldHRpbmdzLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqIEByZXR1cm4gYXJyYXkNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFNob3J0Q29kZXMoKSB7DQoJCXJldHVybiBzZWxmOjokc2M7DQoJfQ0KDQoJLyoqDQoJICogR2V0IHNvcnRlZCBsaXN0IG9mIG1hcHBlZCBzaG9ydGNvZGUgc2V0dGluZ3MgZm9yIGN1cnJlbnQgdXNlci4NCgkgKg0KCSAqIFNvcnRpbmcgZGVwZW5kcyBvbiB0aGUgd2VpZ2h0IGF0dHJpYnV0ZSBhbmQgbWFwcGluZyBvcmRlci4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcmV0dXJuIGFycmF5DQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBnZXRTb3J0ZWRVc2VyU2hvcnRDb2RlcygpIHsNCgkJc2VsZjo6Z2VuZXJhdGVVc2VyRGF0YSgpOw0KCQlyZXR1cm4gc2VsZjo6JHVzZXJfc29ydGVkX3NjOw0KCX0NCg0KCS8qKg0KCSAqIEdldCBsaXN0IG9mIG1hcHBlZCBzaG9ydGNvZGUgc2V0dGluZ3MgZm9yIGN1cnJlbnQgdXNlci4NCgkgKiBAc3RhdGljDQoJICogQHJldHVybiBhcnJheSAtIGFzc29jaWF0ZWQgYXJyYXkgb2Ygc2hvcnRjb2RlcyBzZXR0aW5ncyB3aXRoIHRhZyBhcyB0aGUga2V5Lg0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0VXNlclNob3J0Q29kZXMoKSB7DQoJCXNlbGY6OmdlbmVyYXRlVXNlckRhdGEoKTsNCgkJcmV0dXJuIHNlbGY6OiR1c2VyX3NjOw0KCX0NCg0KCS8qKg0KCSAqIEdldCBtYXBwZWQgc2hvcnRjb2RlIHNldHRpbmdzIGJ5IHRhZy4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcGFyYW0gJHRhZyAtIHNob3J0Y29kZSB0YWcuDQoJICogQHJldHVybiBhcnJheQ0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0U2hvcnRDb2RlKCAkdGFnICkgew0KCQlyZXR1cm4gc2VsZjo6JHNjWyR0YWddOw0KCX0NCg0KCS8qKg0KCSAqIEdldCBhbGwgY2F0ZWdvcmllcyBmb3IgbWFwcGVkIHNob3J0Y29kZXMuDQoJICoNCgkgKiBAc3RhdGljDQoJICogQHJldHVybiBhcnJheQ0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0Q2F0ZWdvcmllcygpIHsNCgkJcmV0dXJuIHNlbGY6OiRjYXRlZ29yaWVzOw0KCX0NCg0KCS8qKg0KCSAqIEdldCBhbGwgY2F0ZWdvcmllcyBmb3IgY3VycmVudCB1c2VyLg0KCSAqDQoJICogQ2F0ZWdvcnkgaXMgYWRkZWQgdG8gdGhlIGxpc3Qgd2hlbiBhdCBsZWFzdCBvbmUgc2hvcnRjb2RlIG9mIHRoaXMgY2F0ZWdvcnkgaXMgYWxsb3dlZCBmb3IgY3VycmVudCB1c2VyDQoJICogYnkgVmMgYWNjZXNzIHJ1bGVzLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqIEByZXR1cm4gYm9vbA0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0VXNlckNhdGVnb3JpZXMoKSB7DQoJCXNlbGY6OmdlbmVyYXRlVXNlckRhdGEoKTsNCgkJcmV0dXJuIHNlbGY6OiR1c2VyX2NhdGVnb3JpZXM7DQoJfQ0KDQoJLyoqDQoJICogRHJvcCBzaG9ydGNvZGUgcGFyYW0uDQoJICoNCgkgKiBAc3RhdGljDQoJICogQHBhcmFtICRuYW1lDQoJICogQHBhcmFtICRhdHRyaWJ1dGVfbmFtZQ0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZHJvcFBhcmFtKCAkbmFtZSwgJGF0dHJpYnV0ZV9uYW1lICkgew0KCQlpZiAoICEgc2VsZjo6JGlzX2luaXQgKSB7DQoJCQl2Y19tYXBwZXIoKS0+YWRkQWN0aXZpdHkoDQoJCQkJJ21hcHBlcicsICdkcm9wX3BhcmFtJywgYXJyYXkoDQoJCQkJCSduYW1lJyA9PiAkbmFtZSwNCgkJCQkJJ2F0dHJpYnV0ZV9uYW1lJyA9PiAkYXR0cmlidXRlX25hbWUNCgkJCQkpDQoJCQkpOw0KCQkJcmV0dXJuOw0KCQl9DQoJCWZvcmVhY2ggKCBzZWxmOjokc2NbJG5hbWVdWydwYXJhbXMnXSBhcyAkaW5kZXggPT4gJHBhcmFtICkgew0KCQkJaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSA9PSAkYXR0cmlidXRlX25hbWUgKSB7DQoJCQkJYXJyYXlfc3BsaWNlKCBzZWxmOjokc2NbJG5hbWVdWydwYXJhbXMnXSwgJGluZGV4LCAxICk7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KCQl9DQoJfQ0KDQoJLyoqDQoJICogUmV0dXJucyBwYXJhbSBzZXR0aW5ncyBmb3IgbWFwcGVkIHNob3J0Y29kZXMuDQoJICoNCgkgKiBAc3RhdGljDQoJICogQHBhcmFtICR0YWcNCgkgKiBAcGFyYW0gJHBhcmFtX25hbWUNCgkgKg0KCSAqIEByZXR1cm4gYm9vbHwgYXJyYXkNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGdldFBhcmFtKCAkdGFnLCAkcGFyYW1fbmFtZSApIHsNCgkJaWYgKCAhIGlzc2V0KCBzZWxmOjokc2NbJHRhZ10gKSApDQoJCQlyZXR1cm4gdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBuYW1lIGZvciBzaG9ydGNvZGU6JXMuIE5hbWUgcmVxdWlyZWQiLCAianNfY29tcG9zZXIiICksICR0YWcgKSApOw0KCQlmb3JlYWNoICggc2VsZjo6JHNjWyR0YWddWydwYXJhbXMnXSBhcyAkaW5kZXggPT4gJHBhcmFtICkgew0KCQkJaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSA9PSAkcGFyYW1fbmFtZSApIHsNCgkJCQlyZXR1cm4gc2VsZjo6JHNjWyR0YWddWydwYXJhbXMnXVskaW5kZXhdOw0KCQkJfQ0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9DQoNCgkvKioNCgkgKiBBZGQgbmV3IHBhcmFtIHRvIHNob3J0Y29kZSBwYXJhbXMgbGlzdC4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcGFyYW0gJG5hbWUNCgkgKiBAcGFyYW0gYXJyYXkgJGF0dHJpYnV0ZQ0KCSAqIEByZXR1cm4gYm9vbA0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gYWRkUGFyYW0oICRuYW1lLCAkYXR0cmlidXRlID0gQXJyYXkoKSApIHsNCgkJaWYgKCAhIHNlbGY6OiRpc19pbml0ICkgew0KCQkJdmNfbWFwcGVyKCktPmFkZEFjdGl2aXR5KA0KCQkJCSdtYXBwZXInLCAnYWRkX3BhcmFtJywgYXJyYXkoDQoJCQkJCSduYW1lJyA9PiAkbmFtZSwNCgkJCQkJJ2F0dHJpYnV0ZScgPT4gJGF0dHJpYnV0ZQ0KCQkJCSkNCgkJCSk7DQoJCQlyZXR1cm47DQoJCX0NCgkJaWYgKCAhIGlzc2V0KCBzZWxmOjokc2NbJG5hbWVdICkgKQ0KCQkJcmV0dXJuIHRyaWdnZXJfZXJyb3IoIHNwcmludGYoIF9fKCAiV3JvbmcgbmFtZSBmb3Igc2hvcnRjb2RlOiVzLiBOYW1lIHJlcXVpcmVkIiwgImpzX2NvbXBvc2VyIiApLCAkbmFtZSApICk7DQoJCWVsc2VpZiAoICEgaXNzZXQoICRhdHRyaWJ1dGVbJ3BhcmFtX25hbWUnXSApICkgew0KCQkJdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBhdHRyaWJ1dGUgZm9yICclcycgc2hvcnRjb2RlLiBBdHRyaWJ1dGUgJ3BhcmFtX25hbWUnIHJlcXVpcmVkIiwgImpzX2NvbXBvc2VyIiApLCAkbmFtZSApICk7DQoJCX0gZWxzZSB7DQoNCgkJCSRyZXBsYWNlZCA9IGZhbHNlOw0KDQoJCQlmb3JlYWNoICggc2VsZjo6JHNjWyRuYW1lXVsncGFyYW1zJ10gYXMgJGluZGV4ID0+ICRwYXJhbSApIHsNCgkJCQlpZiAoICRwYXJhbVsncGFyYW1fbmFtZSddID09ICRhdHRyaWJ1dGVbJ3BhcmFtX25hbWUnXSApIHsNCgkJCQkJJHJlcGxhY2VkID0gdHJ1ZTsNCgkJCQkJc2VsZjo6JHNjWyRuYW1lXVsncGFyYW1zJ11bJGluZGV4XSA9ICRhdHRyaWJ1dGU7DQoJCQkJfQ0KCQkJfQ0KCQkJaWYgKCAkcmVwbGFjZWQgPT09IGZhbHNlICkgc2VsZjo6JHNjWyRuYW1lXVsncGFyYW1zJ11bXSA9ICRhdHRyaWJ1dGU7DQoJCQl2aXN1YWxfY29tcG9zZXIoKS0+YWRkU2hvcnRDb2RlKCBzZWxmOjokc2NbJG5hbWVdICk7DQoJCX0NCgl9DQoNCgkvKioNCgkgKiBDaGFuZ2UgcGFyYW0gYXR0cmlidXRlcyBvZiBtYXBwZWQgc2hvcnRjb2RlLg0KCSAqDQoJICogQHN0YXRpYw0KCSAqIEBwYXJhbSAkbmFtZQ0KCSAqIEBwYXJhbSBhcnJheSAkYXR0cmlidXRlDQoJICogQHJldHVybiBib29sDQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBtdXRhdGVQYXJhbSggJG5hbWUsICRhdHRyaWJ1dGUgPSBBcnJheSgpICkgew0KCQlpZiAoICEgc2VsZjo6JGlzX2luaXQgKSB7DQoJCQl2Y19tYXBwZXIoKS0+YWRkQWN0aXZpdHkoDQoJCQkJJ21hcHBlcicsICdtdXRhdGVfcGFyYW0nLCBhcnJheSgNCgkJCQkJJ25hbWUnID0+ICRuYW1lLA0KCQkJCQknYXR0cmlidXRlJyA9PiAkYXR0cmlidXRlDQoJCQkJKQ0KCQkJKTsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCQlpZiAoICEgaXNzZXQoIHNlbGY6OiRzY1skbmFtZV0gKSApDQoJCQlyZXR1cm4gdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBuYW1lIGZvciBzaG9ydGNvZGU6JXMuIE5hbWUgcmVxdWlyZWQiLCAianNfY29tcG9zZXIiICksICRuYW1lICkgKTsNCgkJZWxzZWlmICggISBpc3NldCggJGF0dHJpYnV0ZVsncGFyYW1fbmFtZSddICkgKSB7DQoJCQl0cmlnZ2VyX2Vycm9yKCBzcHJpbnRmKCBfXyggIldyb25nIGF0dHJpYnV0ZSBmb3IgJyVzJyBzaG9ydGNvZGUuIEF0dHJpYnV0ZSAncGFyYW1fbmFtZScgcmVxdWlyZWQiLCAianNfY29tcG9zZXIiICksICRuYW1lICkgKTsNCgkJfSBlbHNlIHsNCg0KCQkJJHJlcGxhY2VkID0gZmFsc2U7DQoNCgkJCWZvcmVhY2ggKCBzZWxmOjokc2NbJG5hbWVdWydwYXJhbXMnXSBhcyAkaW5kZXggPT4gJHBhcmFtICkgew0KCQkJCWlmICggJHBhcmFtWydwYXJhbV9uYW1lJ10gPT0gJGF0dHJpYnV0ZVsncGFyYW1fbmFtZSddICkgew0KCQkJCQkkcmVwbGFjZWQgPSB0cnVlOw0KCQkJCQlzZWxmOjokc2NbJG5hbWVdWydwYXJhbXMnXVskaW5kZXhdID0gYXJyYXlfbWVyZ2UoICRwYXJhbSwgJGF0dHJpYnV0ZSApOw0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKCAkcmVwbGFjZWQgPT09IGZhbHNlICkgc2VsZjo6JHNjWyRuYW1lXVsncGFyYW1zJ11bXSA9ICRhdHRyaWJ1dGU7DQoNCgkJCXZpc3VhbF9jb21wb3NlcigpLT5hZGRTaG9ydENvZGUoIHNlbGY6OiRzY1skbmFtZV0gKTsNCgkJfQ0KCQlyZXR1cm4gdHJ1ZTsNCgl9DQoNCgkvKioNCgkgKiBSZW1vdmVzIHNob3J0Y29kZSBmcm9tIG1hcHBpbmcgbGlzdC4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcGFyYW0gJG5hbWUNCgkgKiBAcmV0dXJuIGJvb2wNCgkgKi8NCglwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGRyb3BTaG9ydGNvZGUoICRuYW1lICkgew0KCQlpZiAoICEgc2VsZjo6JGlzX2luaXQgKSB7DQoJCQl2Y19tYXBwZXIoKS0+YWRkQWN0aXZpdHkoDQoJCQkJJ21hcHBlcicsICdkcm9wX3Nob3J0Y29kZScsIGFycmF5KA0KCQkJCQknbmFtZScgPT4gJG5hbWUNCgkJCQkpDQoJCQkpOw0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJCXVuc2V0KCBzZWxmOjokc2NbJG5hbWVdICk7DQoJCXZpc3VhbF9jb21wb3NlcigpLT5yZW1vdmVTaG9ydENvZGUoICRuYW1lICk7DQoNCgl9DQoNCgkvKioNCgkgKiBNb2RpZnkgc2hvcnRjb2RlJ3MgbWFwcGVkIHNldHRpbmdzLg0KCSAqIFlvdSBjYW4gbW9kaWZ5IG9ubHkgb25lIG9wdGlvbiBvZiB0aGUgZ3JvdXAgb3B0aW9ucy4NCgkgKiBDYWxsIHRoaXMgbWV0aG9kIHdpdGggJHNldHRpbmdzX25hbWUgcGFyYW0gYXMgYXNzb2NpYXRlZCBhcnJheSB0byBtYXNzIG1vZGlmaWNhdGlvbnMuDQoJICoNCgkgKiBAc3RhdGljDQoJICogQHBhcmFtICRuYW1lICAgICAgICAgLSBzaG9ydGNvZGUnIG5hbWUuDQoJICogQHBhcmFtICRzZXR0aW5nX25hbWUgLSBvcHRpb24ga2V5IG5hbWUgb3IgdGhlIGFycmF5IG9mIG9wdGlvbnMuDQoJICogQHBhcmFtICR2YWx1ZSAgICAgICAgLSB2YWx1ZSBvZiBzZXR0aW5ncyBpZiAkc2V0dGluZ19uYW1lIGlzIG9wdGlvbiBrZXkuDQoJICogQHJldHVybiBhcnJheXxib29sDQoJICovDQoJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBtb2RpZnkoICRuYW1lLCAkc2V0dGluZ19uYW1lLCAkdmFsdWUgPSAnJyApIHsNCgkJaWYgKCAhIHNlbGY6OiRpc19pbml0ICkgew0KCQkJdmNfbWFwcGVyKCktPmFkZEFjdGl2aXR5KA0KCQkJCSdtYXBwZXInLCAnbW9kaWZ5JywgYXJyYXkoDQoJCQkJCSduYW1lJyA9PiAkbmFtZSwNCgkJCQkJJ3NldHRpbmdfbmFtZScgPT4gJHNldHRpbmdfbmFtZSwNCgkJCQkJJ3ZhbHVlJyA9PiAkdmFsdWUNCgkJCQkpDQoJCQkpOw0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJCWlmICggISBpc3NldCggc2VsZjo6JHNjWyRuYW1lXSApICkNCgkJCXJldHVybiB0cmlnZ2VyX2Vycm9yKCBzcHJpbnRmKCBfXyggIldyb25nIG5hbWUgZm9yIHNob3J0Y29kZTolcy4gTmFtZSByZXF1aXJlZCIsICJqc19jb21wb3NlciIgKSwgJG5hbWUgKSApOw0KCQllbHNlaWYgKCAkc2V0dGluZ19uYW1lID09PSAnYmFzZScgKSB7DQoJCQlyZXR1cm4gdHJpZ2dlcl9lcnJvciggc3ByaW50ZiggX18oICJXcm9uZyBzZXR0aW5nX25hbWUgZm9yIHNob3J0Y29kZTolcy4gQmFzZSBjYW4ndCBiZSBtb2RpZmllZC4iLCAianNfY29tcG9zZXIiICksICRuYW1lICkgKTsNCgkJfQ0KCQlpZiAoIGlzX2FycmF5KCAkc2V0dGluZ19uYW1lICkgKSB7DQoJCQlmb3JlYWNoICggJHNldHRpbmdfbmFtZSBhcyAka2V5ID0+ICR2YWx1ZSApIHsNCgkJCQlzZWxmOjptb2RpZnkoICRuYW1lLCAka2V5LCAkdmFsdWUgKTsNCgkJCX0NCgkJfSBlbHNlIHsNCgkJCXNlbGY6OiRzY1skbmFtZV1bJHNldHRpbmdfbmFtZV0gPSAkdmFsdWU7DQoJCQl2aXN1YWxfY29tcG9zZXIoKS0+dXBkYXRlU2hvcnRjb2RlU2V0dGluZygkbmFtZSwgJHNldHRpbmdfbmFtZSwgJHZhbHVlKTsNCgkJfQ0KCQlyZXR1cm4gc2VsZjo6JHNjOw0KCX0NCg0KCS8qKg0KCSAqIFJldHVybnMgInwiIHNlcGFyYXRlZCBsaXN0IG9mIG1hcHBlZCBzaG9ydGNvZGUgdGFncy4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcmV0dXJuIHN0cmluZw0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0VGFnc1JlZ2V4cCgpIHsNCgkJaWYgKCBlbXB0eSggc2VsZjo6JHRhZ3NfcmVnZXhwICkgKSB7DQoJCQlzZWxmOjokdGFnc19yZWdleHAgPSBpbXBsb2RlKCAnfCcsIGFycmF5X2tleXMoIHNlbGY6OiRzYyApICk7DQoJCX0NCgkJcmV0dXJuIHNlbGY6OiR0YWdzX3JlZ2V4cDsNCgl9DQoNCgkvKioNCgkgKiBTb3J0aW5nIG1ldGhvZCBmb3IgV1BCTWFwOjpnZW5lcmF0ZVVzZXJEYXRhIG1ldGhvZC4gQ2FsbGVkIGJ5IHVzb3J0IHBocCBmdW5jdGlvbi4NCgkgKg0KCSAqIEBzdGF0aWMNCgkgKiBAcGFyYW0gJGENCgkgKiBAcGFyYW0gJGINCgkgKiBAcmV0dXJuIGludA0KCSAqLw0KCXB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gc29ydCggJGEsICRiICkgew0KCQkkYV93ZWlnaHQgPSBpc3NldCggJGFbJ3dlaWdodCddICkgPyAoaW50KSRhWyd3ZWlnaHQnXSA6IDA7DQoJCSRiX3dlaWdodCA9IGlzc2V0KCAkYlsnd2VpZ2h0J10gKSA/IChpbnQpJGJbJ3dlaWdodCddIDogMDsNCgkJaWYgKCAkYV93ZWlnaHQgPT0gJGJfd2VpZ2h0ICkgew0KCQkJJGNtcGEgPSBhcnJheV9zZWFyY2goICRhLCBzZWxmOjokdXNlcl9zb3J0ZWRfc2MgKTsNCgkJCSRjbXBiID0gYXJyYXlfc2VhcmNoKCAkYiwgc2VsZjo6JHVzZXJfc29ydGVkX3NjICk7DQoJCQlyZXR1cm4gKCAkY21wYSA+ICRjbXBiICkgPyAxIDogLSAxOw0KCQl9DQoJCXJldHVybiAoICRhX3dlaWdodCA8ICRiX3dlaWdodCApID8gMSA6IC0gMTsNCgl9DQp9',
	'include/classes/shortcodes/shortcodes.php' => 'PD9waHANCi8qKg0KICogV1BCYWtlcnkgVmlzdWFsIENvbXBvc2VyIFNob3J0Y29kZXMgbWFpbg0KICoNCiAqIEBwYWNrYWdlIFdQQmFrZXJ5VmlzdWFsQ29tcG9zZXINCiAqDQogKi8NCg0KLyogYWJzdHJhY3QgVmlzdWFsQ29tcG9zZXIgY2xhc3MgdG8gY3JlYXRlIHN0cnVjdHVyYWwgb2JqZWN0IG9mIGFueSB0eXBlICovDQppZiAoICEgY2xhc3NfZXhpc3RzKCAnV1BCYWtlcnlWaXN1YWxDb21wb3NlckFic3RyYWN0JyApICkgew0KCWFic3RyYWN0IGNsYXNzIFdQQmFrZXJ5VmlzdWFsQ29tcG9zZXJBYnN0cmFjdCB7DQoJCXB1YmxpYyBzdGF0aWMgJGNvbmZpZzsNCgkJcHJvdGVjdGVkICRpc19wbHVnaW4gPSB0cnVlOw0KCQlwcm90ZWN0ZWQgJGlzX3RoZW1lID0gZmFsc2U7DQoJCXByb3RlY3RlZCAkZGlzYWJsZV91cGRhdGVyID0gZmFsc2U7DQoJCXByb3RlY3RlZCAkc2V0dGluZ3NfYXNfdGhlbWUgPSBmYWxzZTsNCgkJcHJvdGVjdGVkICRhc19uZXR3b3JrX3BsdWdpbiA9IGZhbHNlOw0KCQlwcm90ZWN0ZWQgJGlzX2luaXQgPSBmYWxzZTsNCgkJcHJvdGVjdGVkICRjb250cm9sc19jc3Nfc2V0dGluZ3MgPSAnY2MnOw0KCQlwcm90ZWN0ZWQgJGNvbnRyb2xzX2xpc3QgPSBhcnJheSgnZWRpdCcsICdjbG9uZScsICdkZWxldGUnKTsNCgkJcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCkgew0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGluaXQoICRzZXR0aW5ncyApIHsNCgkJCXNlbGY6OiRjb25maWcgPSAoYXJyYXkpJHNldHRpbmdzOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGFkZEFjdGlvbiggJGFjdGlvbiwgJG1ldGhvZCwgJHByaW9yaXR5ID0gMTAgKSB7DQoJCQlhZGRfYWN0aW9uKCAkYWN0aW9uLCBhcnJheSggJiR0aGlzLCAkbWV0aG9kICksICRwcmlvcml0eSApOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIHJlbW92ZUFjdGlvbiggJGFjdGlvbiwgJG1ldGhvZCwgJHByaW9yaXR5ID0gMTAgKSB7DQoJCQlyZXR1cm4gcmVtb3ZlX2FjdGlvbiggJGFjdGlvbiwgYXJyYXkoICR0aGlzLCAkbWV0aG9kICksICRwcmlvcml0eSApOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGFkZEZpbHRlciggJGZpbHRlciwgJG1ldGhvZCwgJHByaW9yaXR5ID0gMTAgKSB7DQoJCQlyZXR1cm4gYWRkX2ZpbHRlciggJGZpbHRlciwgYXJyYXkoICYkdGhpcywgJG1ldGhvZCApLCAkcHJpb3JpdHkgKTsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiByZW1vdmVGaWx0ZXIoICRmaWx0ZXIsICRtZXRob2QsICRwcmlvcml0eSA9IDEwICkgew0KCQkJcmVtb3ZlX2ZpbHRlciggJGZpbHRlciwgYXJyYXkoICYkdGhpcywgJG1ldGhvZCApLCAkcHJpb3JpdHkgKTsNCgkJfQ0KDQoJCS8qIFNob3J0Y29kZSBtZXRob2RzICovDQoJCXB1YmxpYyBmdW5jdGlvbiBhZGRTaG9ydENvZGUoICR0YWcsICRmdW5jICkgew0KCQkJYWRkX3Nob3J0Y29kZSggJHRhZywgJGZ1bmMgKTsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBkb1Nob3J0Q29kZSggJGNvbnRlbnQgKSB7DQoJCQlkb19zaG9ydGNvZGUoICRjb250ZW50ICk7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gcmVtb3ZlU2hvcnRDb2RlKCAkdGFnICkgew0KCQkJcmVtb3ZlX3Nob3J0Y29kZSggJHRhZyApOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIHBvc3QoICRwYXJhbSApIHsNCgkJCXJldHVybiBpc3NldCggJF9QT1NUWyRwYXJhbV0gKSA/ICRfUE9TVFskcGFyYW1dIDogbnVsbDsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBnZXQoICRwYXJhbSApIHsNCgkJCXJldHVybiBpc3NldCggJF9HRVRbJHBhcmFtXSApID8gJF9HRVRbJHBhcmFtXSA6IG51bGw7DQoJCX0NCg0KCQkvKioNCgkJICogQGRlcHJlY2F0ZWQNCgkJICogQHBhcmFtICRhc3NldA0KCQkgKiBAcmV0dXJuIHN0cmluZw0KCQkgKi8NCgkJcHVibGljIGZ1bmN0aW9uIGFzc2V0VVJMKCAkYXNzZXQgKSB7DQoJCQlyZXR1cm4gdmNfYXNzZXRfdXJsKCAkYXNzZXQgKTsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBhc3NldFBhdGgoICRhc3NldCApIHsNCgkJCXJldHVybiBzZWxmOjokY29uZmlnWydBUFBfUk9PVCddIC4gc2VsZjo6JGNvbmZpZ1snQVNTRVRTX0RJUiddIC4gJGFzc2V0Ow0KCQl9DQoNCgkJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBjb25maWcoICRuYW1lICkgew0KCQkJcmV0dXJuIGlzc2V0KCBzZWxmOjokY29uZmlnWyRuYW1lXSApID8gc2VsZjo6JGNvbmZpZ1skbmFtZV0gOiBudWxsOw0KCQl9DQoJfQ0KfQ0KDQpkZWZpbmUoICdWQ19TSE9SVENPREVfQ1VTVE9NSVpFX1BSRUZJWCcsICd2Y190aGVtZV8nICk7DQpkZWZpbmUoICdWQ19TSE9SVENPREVfQkVGT1JFX0NVU1RPTUlaRV9QUkVGSVgnLCAndmNfdGhlbWVfYmVmb3JlXycgKTsNCmRlZmluZSggJ1ZDX1NIT1JUQ09ERV9BRlRFUl9DVVNUT01JWkVfUFJFRklYJywgJ3ZjX3RoZW1lX2FmdGVyXycgKTsNCmRlZmluZSggJ1ZDX1NIT1JUQ09ERV9DVVNUT01fQ1NTX0ZJTFRFUl9UQUcnLCAndmNfc2hvcnRjb2Rlc19jc3NfY2xhc3MnICk7DQppZiAoICEgY2xhc3NfZXhpc3RzKCAnV1BCYWtlcnlTaG9ydENvZGUnICkgKSB7DQoJYWJzdHJhY3QgY2xhc3MgV1BCYWtlcnlTaG9ydENvZGUgZXh0ZW5kcyBXUEJha2VyeVZpc3VhbENvbXBvc2VyQWJzdHJhY3Qgew0KDQoJCXByb3RlY3RlZCAkc2hvcnRjb2RlOw0KCQlwcm90ZWN0ZWQgJGh0bWxfdGVtcGxhdGU7DQoNCgkJcHJvdGVjdGVkICRhdHRzLCAkc2V0dGluZ3M7DQoJCXByb3RlY3RlZCBzdGF0aWMgJGVucXVldWVfaW5kZXggPSAwOw0KCQlwcm90ZWN0ZWQgc3RhdGljICRqc19zY3JpcHRzID0gYXJyYXkoKTsNCgkJcHJvdGVjdGVkIHN0YXRpYyAkY3NzX3NjcmlwdHMgPSBhcnJheSgpOw0KCQlwcm90ZWN0ZWQgJHNob3J0Y29kZV9zdHJpbmcgPSAnJzsNCgkJcHJvdGVjdGVkICRjb250cm9sc190ZW1wbGF0ZV9maWxlID0gJ2VkaXRvcnMvcGFydGlhbHMvYmFja2VuZF9jb250cm9scy50cGwucGhwJzsNCg0KCQlwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoICRzZXR0aW5ncyApIHsNCgkJCSR0aGlzLT5zZXR0aW5ncyA9ICRzZXR0aW5nczsNCgkJCSR0aGlzLT5zaG9ydGNvZGUgPSAkdGhpcy0+c2V0dGluZ3NbJ2Jhc2UnXTsNCg0KCQkJJHRoaXMtPmFkZEFjdGlvbiggJ2FkbWluX2luaXQnLCAnZW5xdWV1ZUFzc2V0cycgKTsNCgkJCSR0aGlzLT5hZGRBY3Rpb24oICdhZG1pbl9oZWFkJywgJ3ByaW50SWNvblN0eWxlcycgKTsNCgkJCS8vIGlmKCR0aGlzLT5pc0FkbWluKCkgfHwgIXNob3J0Y29kZV9leGlzdHMoJHRoaXMtPnNob3J0Y29kZSkpICR0aGlzLT5hZGRTaG9ydENvZGUoJHRoaXMtPnNob3J0Y29kZSwgQXJyYXkoJHRoaXMsICdvdXRwdXQnKSk7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gYWRkSW5saW5lQW5jaG9ycyggJGNvbnRlbnQgKSB7DQoJCQlyZXR1cm4gKCAkdGhpcy0+aXNJbmxpbmUoKSB8fCAkdGhpcy0+aXNFZGl0b3IoKSAmJiAkdGhpcy0+c2V0dGluZ3MoICdpc19jb250YWluZXInICkgPT09IHRydWUgPyAnPHNwYW4gY2xhc3M9InZjX2NvbnRhaW5lci1hbmNob3IiPjwvc3Bhbj4nIDogJycgKSAuICRjb250ZW50Ow0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGVucXVldWVBc3NldHMoKSB7DQoJCQlpZiAoICEgZW1wdHkoICR0aGlzLT5zZXR0aW5nc1snYWRtaW5fZW5xdWV1ZV9qcyddICkgKSAkdGhpcy0+cmVnaXN0ZXJKcyggJHRoaXMtPnNldHRpbmdzWydhZG1pbl9lbnF1ZXVlX2pzJ10gKTsNCgkJCWlmICggISBlbXB0eSggJHRoaXMtPnNldHRpbmdzWydhZG1pbl9lbnF1ZXVlX2NzcyddICkgKSAkdGhpcy0+cmVnaXN0ZXJDc3MoICR0aGlzLT5zZXR0aW5nc1snYWRtaW5fZW5xdWV1ZV9jc3MnXSApOw0KCQl9DQoNCgkJLyoqDQoJCSAqIFByaW50cyBvdXQgdGhlIHN0eWxlcyBuZWVkZWQgdG8gcmVuZGVyIHRoZSBlbGVtZW50IGljb24gZm9yIHRoZSBiYWNrIGVuZCBpbnRlcmZhY2UuDQoJCSAqIE9ubHkgcGVyZm9ybWVkIGlmIHRoZSAnaWNvbicgc2V0dGluZyBpcyBhIHZhbGlkIFVSTC4NCgkJICoNCgkJICogQHJldHVybiB2b2lkDQoJCSAqIEBzaW5jZSAgNC4yDQoJCSAqIEBhdXRob3IgQmVuamFtaW4gSW50YWwNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBwcmludEljb25TdHlsZXMoKSB7DQoJCQlpZiAoICEgZmlsdGVyX3ZhciggJHRoaXMtPnNldHRpbmdzKCAnaWNvbicgKSwgRklMVEVSX1ZBTElEQVRFX1VSTCApICkgew0KCQkJCXJldHVybjsNCgkJCX0NCgkJCWVjaG8gIg0KICAgICAgICAgICAgPHN0eWxlPg0KICAgICAgICAgICAgICAgIC52Y19lbC1jb250YWluZXIgIyIuZXNjX2F0dHIoICR0aGlzLT5zZXR0aW5nc1snYmFzZSddICkuIiAudmNfZWxlbWVudC1pY29uLA0KICAgICAgICAgICAgICAgIC53cGJfIi5lc2NfYXR0ciggJHRoaXMtPnNldHRpbmdzWydiYXNlJ10gKS4iIC53cGJfZWxlbWVudF90aXRsZSAudmNfZWxlbWVudC1pY29uIHsNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCIgLiBlc2NfdXJsKCAkdGhpcy0+c2V0dGluZ3NbJ2ljb24nXSApIC4gIik7DQogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiIC4gZXNjX3VybCggJHRoaXMtPnNldHRpbmdzWydpY29uJ10gKSAuICIpOw0KICAgICAgICAgICAgICAgICAgICAtd2Via2l0LWJhY2tncm91bmQtc2l6ZTogY29udGFpbjsNCiAgICAgICAgICAgICAgICAgICAgLW1vei1iYWNrZ3JvdW5kLXNpemU6IGNvbnRhaW47DQogICAgICAgICAgICAgICAgICAgIC1tcy1iYWNrZ3JvdW5kLXNpemU6IGNvbnRhaW47DQogICAgICAgICAgICAgICAgICAgIC1vLWJhY2tncm91bmQtc2l6ZTogY29udGFpbjsNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1zaXplOiBjb250YWluOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIDwvc3R5bGU+IjsNCgkJfQ0KDQoJCXByb3RlY3RlZCBmdW5jdGlvbiByZWdpc3RlckpzKCAkcGFyYW0gKSB7DQoJCQlpZiAoIGlzX2FycmF5KCAkcGFyYW0gKSApIHsNCgkJCQlmb3JlYWNoICggJHBhcmFtIGFzICR2YWx1ZSApIHsNCgkJCQkJJHRoaXMtPnJlZ2lzdGVySnMoICR2YWx1ZSApOw0KCQkJCX0NCgkJCX0gZWxzZWlmICggaXNfc3RyaW5nKCAkcGFyYW0gKSAmJiAhIGVtcHR5KCAkcGFyYW0gKSApIHsNCgkJCQkkbmFtZSA9ICR0aGlzLT5zaG9ydGNvZGUgLiAnX2VucXVldWVfanNfJyAuIHNlbGY6OiRlbnF1ZXVlX2luZGV4ICsrOw0KCQkJCXNlbGY6OiRqc19zY3JpcHRzW10gPSAkbmFtZTsNCgkJCQl3cF9yZWdpc3Rlcl9zY3JpcHQoICRuYW1lLCAkcGFyYW0sIGFycmF5KCAnanF1ZXJ5JyApLCB0aW1lKCksIHRydWUgKTsNCgkJCX0NCgkJfQ0KDQoJCXByb3RlY3RlZCBmdW5jdGlvbiByZWdpc3RlckNzcyggJHBhcmFtICkgew0KCQkJaWYgKCBpc19hcnJheSggJHBhcmFtICkgKSB7DQoJCQkJZm9yZWFjaCAoICRwYXJhbSBhcyAkdmFsdWUgKSB7DQoJCQkJCSR0aGlzLT5yZWdpc3RlckNzcyggJHZhbHVlICk7DQoJCQkJfQ0KCQkJfSBlbHNlaWYgKCBpc19zdHJpbmcoICRwYXJhbSApICkgew0KCQkJCSRuYW1lID0gJHRoaXMtPnNob3J0Y29kZSAuICdfZW5xdWV1ZV9jc3NfJyAuIHNlbGY6OiRlbnF1ZXVlX2luZGV4ICsrOw0KCQkJCXNlbGY6OiRjc3Nfc2NyaXB0c1tdID0gJG5hbWU7DQoJCQkJd3BfcmVnaXN0ZXJfc3R5bGUoICRuYW1lLCAkcGFyYW0sIGFycmF5KCAnanNfY29tcG9zZXInICksIHRpbWUoKSApOw0KCQkJfQ0KCQl9DQoNCgkJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBlbnF1ZXVlQ3NzKCkgew0KCQkJZm9yZWFjaCAoIHNlbGY6OiRjc3Nfc2NyaXB0cyBhcyAkc3R5bGVzaGVldCApIHsNCgkJCQl3cF9lbnF1ZXVlX3N0eWxlKCAkc3R5bGVzaGVldCApOw0KCQkJfQ0KCQl9DQoNCgkJcHVibGljIHN0YXRpYyBmdW5jdGlvbiBlbnF1ZXVlSnMoKSB7DQoJCQlmb3JlYWNoICggc2VsZjo6JGpzX3NjcmlwdHMgYXMgJHNjcmlwdCApIHsNCgkJCQl3cF9lbnF1ZXVlX3NjcmlwdCggJHNjcmlwdCApOw0KCQkJfQ0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIHNob3J0Y29kZSggJHNob3J0Y29kZSApIHsNCg0KCQl9DQoNCgkJcHJvdGVjdGVkIGZ1bmN0aW9uIHNldFRlbXBsYXRlKCAkdGVtcGxhdGUgKSB7DQoJCQkkdGhpcy0+aHRtbF90ZW1wbGF0ZSA9ICR0ZW1wbGF0ZTsNCgkJfQ0KDQoJCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRUZW1wbGF0ZSgpIHsNCgkJCWlmICggaXNzZXQoICR0aGlzLT5odG1sX3RlbXBsYXRlICkgKSByZXR1cm4gJHRoaXMtPmh0bWxfdGVtcGxhdGU7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0RmlsZU5hbWUoKSB7DQoJCQlyZXR1cm4gJHRoaXMtPnNob3J0Y29kZTsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBGaW5kIGh0bWwgdGVtcGxhdGUgZm9yIHNob3J0Y29kZSBvdXRwdXQuDQoJCSAqLw0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gZmluZFNob3J0Y29kZVRlbXBsYXRlKCkgew0KCQkJLy8gQ2hlY2sgdGVtcGxhdGUgcGF0aCBpbiBzaG9ydGNvZGUncyBtYXBwaW5nIHNldHRpbmdzDQoJCQlpZiAoICEgZW1wdHkoICR0aGlzLT5zZXR0aW5nc1snaHRtbF90ZW1wbGF0ZSddICkgJiYgaXNfZmlsZSggJHRoaXMtPnNldHRpbmdzKCAnaHRtbF90ZW1wbGF0ZScgKSApICkgew0KCQkJCXJldHVybiAkdGhpcy0+c2V0VGVtcGxhdGUoICR0aGlzLT5zZXR0aW5nc1snaHRtbF90ZW1wbGF0ZSddICk7DQoJCQl9DQoNCgkJCS8vIENoZWNrIHRlbXBsYXRlIGluIHRoZW1lIGRpcmVjdG9yeQ0KCQkJJHVzZXJfdGVtcGxhdGUgPSB2Y19zaG9ydGNvZGVzX3RoZW1lX3RlbXBsYXRlc19kaXIoICR0aGlzLT5nZXRGaWxlbmFtZSgpIC4gJy5waHAnICk7DQoJCQlpZiAoIGlzX2ZpbGUoICR1c2VyX3RlbXBsYXRlICkgKSB7DQoJCQkJcmV0dXJuICR0aGlzLT5zZXRUZW1wbGF0ZSggJHVzZXJfdGVtcGxhdGUgKTsNCgkJCX0NCg0KCQkJLy8gQ2hlY2sgZGVmYXVsdCBwbGFjZQ0KCQkJJGRlZmF1bHRfZGlyID0gdmNfbWFuYWdlcigpLT5nZXREZWZhdWx0U2hvcnRjb2Rlc1RlbXBsYXRlc0RpcigpIC4gJy8nOw0KCQkJaWYgKCBpc19maWxlKCAkZGVmYXVsdF9kaXIgLiAkdGhpcy0+Z2V0RmlsZW5hbWUoKSAuICcucGhwJyApICkgew0KCQkJCXJldHVybiAkdGhpcy0+c2V0VGVtcGxhdGUoICRkZWZhdWx0X2RpciAuICR0aGlzLT5nZXRGaWxlbmFtZSgpIC4gJy5waHAnICk7DQoJCQl9DQoJCX0NCg0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gY29udGVudCggJGF0dHMsICRjb250ZW50ID0gbnVsbCApIHsNCgkJCXJldHVybiAkdGhpcy0+bG9hZFRlbXBsYXRlKCAkYXR0cywgJGNvbnRlbnQgKTsNCgkJfQ0KDQoJCXByb3RlY3RlZCBmdW5jdGlvbiBsb2FkVGVtcGxhdGUoICRhdHRzLCAkY29udGVudCA9IG51bGwgKSB7DQoJCQkNCgkJCSMgc3RhcnQ6IG1vZGlmaWVkIGJ5IEFybGluZCBOdXNoaQ0KICAgICAgICAJZ2xvYmFsICRhdHRzX3ZhbHVlczsNCiAgICAgICAgCSRhdHRzX3ZhbHVlcyA9ICRhdHRzOw0KICAgICAgICAJIyBlbmQ6IG1vZGlmaWVkIGJ5IEFybGluZCBOdXNoaQ0KICAgICAgICAJDQoJCQkkb3V0cHV0ID0gJyc7DQoJCQlpZiAoICEgaXNfbnVsbCggJGNvbnRlbnQgKSApICRjb250ZW50ID0gYXBwbHlfZmlsdGVycyggJ3ZjX3Nob3J0Y29kZV9jb250ZW50X2ZpbHRlcicsICRjb250ZW50ICk7DQoJCQkkdGhpcy0+ZmluZFNob3J0Y29kZVRlbXBsYXRlKCk7DQoJCQlpZiAoICR0aGlzLT5odG1sX3RlbXBsYXRlICkgew0KCQkJCW9iX3N0YXJ0KCk7DQoJCQkJaW5jbHVkZSAoICR0aGlzLT5odG1sX3RlbXBsYXRlICk7DQoJCQkJJG91dHB1dCA9IG9iX2dldF9jb250ZW50cygpOw0KCQkJCW9iX2VuZF9jbGVhbigpOw0KCQkJfSBlbHNlIHsNCgkJCQl0cmlnZ2VyX2Vycm9yKCBzcHJpbnRmKCBfXyggJ1RlbXBsYXRlIGZpbGUgaXMgbWlzc2luZyBmb3IgYCVzYCBzaG9ydGNvZGUuIE1ha2Ugc3VyZSB5b3UgaGF2ZSBgJXNgIGZpbGUgaW4geW91ciB0aGVtZSBmb2xkZXIuJywgJ2pzX2NvbXBvc2VyJyApLCAkdGhpcy0+c2hvcnRjb2RlLCAnd3AtY29udGVudC90aGVtZXMveW91cl90aGVtZS92Y190ZW1wbGF0ZXMvJyAuICR0aGlzLT5zaG9ydGNvZGUgLiAnLnBocCcgKSApOw0KCQkJfQ0KCQkJcmV0dXJuIGFwcGx5X2ZpbHRlcnMoICd2Y19zaG9ydGNvZGVfY29udGVudF9maWx0ZXJfYWZ0ZXInLCAkb3V0cHV0ICk7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gY29udGVudEFkbWluKCAkYXR0cywgJGNvbnRlbnQgKSB7DQoJCQkkZWxlbWVudCA9ICR0aGlzLT5zaG9ydGNvZGU7DQoJCQkkb3V0cHV0ID0gJGN1c3RvbV9tYXJrdXAgPSAkd2lkdGggPSAkZWxfcG9zaXRpb24gPSAnJzsNCg0KCQkJaWYgKCAkY29udGVudCAhPSBOVUxMICkgew0KCQkJCSRjb250ZW50ID0gd3BhdXRvcCggc3RyaXBzbGFzaGVzKCAkY29udGVudCApICk7DQoJCQl9DQoNCgkJCWlmICggaXNzZXQoICR0aGlzLT5zZXR0aW5nc1sncGFyYW1zJ10gKSApIHsNCgkJCQkkc2hvcnRjb2RlX2F0dHJpYnV0ZXMgPSBhcnJheSggJ3dpZHRoJyA9PiAnMS8xJyApOw0KCQkJCWZvcmVhY2ggKCAkdGhpcy0+c2V0dGluZ3NbJ3BhcmFtcyddIGFzICRwYXJhbSApIHsNCgkJCQkJaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSAhPSAnY29udGVudCcgKSB7DQoJCQkJCQlpZiAoIGlzc2V0KCAkcGFyYW1bJ3ZhbHVlJ10gKSApIHsNCgkJCQkJCQkkc2hvcnRjb2RlX2F0dHJpYnV0ZXNbJHBhcmFtWydwYXJhbV9uYW1lJ11dID0gaXNfc3RyaW5nKCAkcGFyYW1bJ3ZhbHVlJ10gKSA/IF9fKCAkcGFyYW1bJ3ZhbHVlJ10sICJqc19jb21wb3NlciIgKSA6ICRwYXJhbVsndmFsdWUnXTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJJHNob3J0Y29kZV9hdHRyaWJ1dGVzWyRwYXJhbVsncGFyYW1fbmFtZSddXSA9ICcnOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2UgaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSA9PSAnY29udGVudCcgJiYgJGNvbnRlbnQgPT0gTlVMTCApIHsNCgkJCQkJCSRjb250ZW50ID0gaXNzZXQoICRwYXJhbVsndmFsdWUnXSApID8gX18oICRwYXJhbVsndmFsdWUnXSwgImpzX2NvbXBvc2VyIiApIDogJyc7DQoJCQkJCX0NCgkJCQl9DQoJCQkJZXh0cmFjdCggc2hvcnRjb2RlX2F0dHMoDQoJCQkJCSRzaG9ydGNvZGVfYXR0cmlidXRlcw0KCQkJCQksICRhdHRzICkgKTsNCgkJCQkkZWxlbSA9ICR0aGlzLT5nZXRFbGVtZW50SG9sZGVyKCAkd2lkdGggKTsNCgkJCQlpZiAoIGlzc2V0KCAkYXR0c1snZWxfcG9zaXRpb24nXSApICkgJGVsX3Bvc2l0aW9uID0gJGF0dHNbJ2VsX3Bvc2l0aW9uJ107DQoJCQkJJGluZXIgPSAkdGhpcy0+b3V0cHV0VGl0bGUoICR0aGlzLT5zZXR0aW5nc1snbmFtZSddICk7DQoJCQkJZm9yZWFjaCAoICR0aGlzLT5zZXR0aW5nc1sncGFyYW1zJ10gYXMgJHBhcmFtICkgew0KCQkJCQkkcGFyYW1fdmFsdWUgPSBpc3NldCggJCRwYXJhbVsncGFyYW1fbmFtZSddICkgPyAkJHBhcmFtWydwYXJhbV9uYW1lJ10gOiAnJzsNCgkJCQkJaWYgKCBpc19hcnJheSggJHBhcmFtX3ZhbHVlICkgKSB7DQoJCQkJCQkvLyBHZXQgZmlyc3QgZWxlbWVudCBmcm9tIHRoZSBhcnJheQ0KCQkJCQkJcmVzZXQoICRwYXJhbV92YWx1ZSApOw0KCQkJCQkJJGZpcnN0X2tleSA9IGtleSggJHBhcmFtX3ZhbHVlICk7DQoJCQkJCQkkcGFyYW1fdmFsdWUgPSBpc19udWxsKCAkZmlyc3Rfa2V5ICkgPyAnJyA6ICRwYXJhbV92YWx1ZVskZmlyc3Rfa2V5XTsNCgkJCQkJfQ0KCQkJCQkkaW5lciAuPSAkdGhpcy0+c2luZ2xlUGFyYW1IdG1sSG9sZGVyKCAkcGFyYW0sICRwYXJhbV92YWx1ZSApOw0KCQkJCX0NCgkJCQkkZWxlbSA9IHN0cl9pcmVwbGFjZSggJyV3cGJfZWxlbWVudF9jb250ZW50JScsICRpbmVyLCAkZWxlbSApOw0KCQkJCSRvdXRwdXQgLj0gJGVsZW07DQoJCQl9IGVsc2Ugew0KCQkJCS8vVGhpcyBpcyB1c2VkIGZvciBzaG9ydGNvZGVzIHdpdGhvdXQgcGFyYW1zIChsaWtlIHNpbXBsZSBkaXZpZGVyKQ0KCQkJCS8vICRjb2x1bW5fY29udHJvbHMgPSAkdGhpcy0+Z2V0Q29sdW1uQ29udHJvbHMoJHRoaXMtPnNldHRpbmdzWydjb250cm9scyddKTsNCgkJCQkkd2lkdGggPSAnMS8xJzsNCg0KCQkJCSRlbGVtID0gJHRoaXMtPmdldEVsZW1lbnRIb2xkZXIoICR3aWR0aCApOw0KDQoJCQkJJGlubmVyID0gJyc7DQoJCQkJaWYgKCBpc3NldCggJHRoaXMtPnNldHRpbmdzWyJjdXN0b21fbWFya3VwIl0gKSAmJiAkdGhpcy0+c2V0dGluZ3NbImN1c3RvbV9tYXJrdXAiXSAhPSAnJyApIHsNCgkJCQkJaWYgKCAkY29udGVudCAhPSAnJyApIHsNCgkJCQkJCSRjdXN0b21fbWFya3VwID0gc3RyX2lyZXBsYWNlKCAiJWNvbnRlbnQlIiwgJGNvbnRlbnQsICR0aGlzLT5zZXR0aW5nc1siY3VzdG9tX21hcmt1cCJdICk7DQoJCQkJCX0gZWxzZSBpZiAoICRjb250ZW50ID09ICcnICYmIGlzc2V0KCAkdGhpcy0+c2V0dGluZ3NbImRlZmF1bHRfY29udGVudF9pbl90ZW1wbGF0ZSJdICkgJiYgJHRoaXMtPnNldHRpbmdzWyJkZWZhdWx0X2NvbnRlbnRfaW5fdGVtcGxhdGUiXSAhPSAnJyApIHsNCgkJCQkJCSRjdXN0b21fbWFya3VwID0gc3RyX2lyZXBsYWNlKCAiJWNvbnRlbnQlIiwgJHRoaXMtPnNldHRpbmdzWyJkZWZhdWx0X2NvbnRlbnRfaW5fdGVtcGxhdGUiXSwgJHRoaXMtPnNldHRpbmdzWyJjdXN0b21fbWFya3VwIl0gKTsNCgkJCQkJfQ0KCQkJCQkvLyRvdXRwdXQgLj0gZG9fc2hvcnRjb2RlKCR0aGlzLT5zZXR0aW5nc1siY3VzdG9tX21hcmt1cCJdKTsNCgkJCQkJJGlubmVyIC49IGRvX3Nob3J0Y29kZSggJGN1c3RvbV9tYXJrdXAgKTsNCgkJCQl9DQoJCQkJJGVsZW0gPSBzdHJfaXJlcGxhY2UoICcld3BiX2VsZW1lbnRfY29udGVudCUnLCAkaW5uZXIsICRlbGVtICk7DQoJCQkJJG91dHB1dCAuPSAkZWxlbTsNCgkJCX0NCgkJCXJldHVybiAkb3V0cHV0Ow0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGlzQWRtaW4oKSB7DQoJCQlyZXR1cm4gaXNfYWRtaW4oKSAmJiAhIGVtcHR5KCAkX1BPU1RbJ2FjdGlvbiddICkgJiYgcHJlZ19tYXRjaCggJy9ed3BiXF8vJywgJF9QT1NUWydhY3Rpb24nXSApOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGlzSW5saW5lKCkgew0KCQkJcmV0dXJuIHZjX2lzX2lubGluZSgpOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGlzRWRpdG9yKCkgew0KCQkJcmV0dXJuIHZjX2lzX2VkaXRvcigpOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIG91dHB1dCggJGF0dHMsICRjb250ZW50ID0gbnVsbCwgJGJhc2UgPSAnJyApIHsNCgkJCSR0aGlzLT5hdHRzID0gJHRoaXMtPnByZXBhcmVBdHRzKCAkYXR0cyApOw0KCQkJJG91dHB1dCA9ICcnOw0KCQkJJGNvbnRlbnQgPSBlbXB0eSggJGNvbnRlbnQgKSAmJiAhIGVtcHR5KCAkYXR0c1snY29udGVudCddICkgPyAkYXR0c1snY29udGVudCddIDogJGNvbnRlbnQ7DQoJCQlpZiAoICggJHRoaXMtPmlzSW5saW5lKCkgfHwgdmNfaXNfcGFnZV9lZGl0YWJsZSgpICkgJiYgbWV0aG9kX2V4aXN0cyggJHRoaXMsICdjb250ZW50SW5saW5lJyApICkgew0KCQkJCSRvdXRwdXQgLj0gJHRoaXMtPmNvbnRlbnRJbmxpbmUoICR0aGlzLT5hdHRzLCAkY29udGVudCApOw0KCQkJfSBlbHNlaWYgKCAkdGhpcy0+aXNBZG1pbigpICkgew0KCQkJCSRvdXRwdXQgLj0gJHRoaXMtPmNvbnRlbnRBZG1pbiggJHRoaXMtPmF0dHMsICRjb250ZW50ICk7DQoJCQl9DQoJCQlpZiAoIGVtcHR5KCAkb3V0cHV0ICkgKSB7DQoJCQkJJGN1c3RvbV9vdXRwdXQgPSBWQ19TSE9SVENPREVfQ1VTVE9NSVpFX1BSRUZJWCAuICR0aGlzLT5zaG9ydGNvZGU7DQoJCQkJJGN1c3RvbV9vdXRwdXRfYmVmb3JlID0gVkNfU0hPUlRDT0RFX0JFRk9SRV9DVVNUT01JWkVfUFJFRklYIC4gJHRoaXMtPnNob3J0Y29kZTsgLy8gYmVmb3JlIHNob3J0Y29kZSBmdW5jdGlvbiBob29rDQoJCQkJJGN1c3RvbV9vdXRwdXRfYWZ0ZXIgPSBWQ19TSE9SVENPREVfQUZURVJfQ1VTVE9NSVpFX1BSRUZJWCAuICR0aGlzLT5zaG9ydGNvZGU7IC8vIGFmdGVyIHNob3J0Y29kZSBmdW5jdGlvbiBob29rDQoNCgkJCQkvLyBCZWZvcmUgc2hvcnRjb2RlDQoJCQkJaWYgKCBmdW5jdGlvbl9leGlzdHMoICRjdXN0b21fb3V0cHV0X2JlZm9yZSApICkgew0KCQkJCQkkb3V0cHV0IC49ICRjdXN0b21fb3V0cHV0X2JlZm9yZSggJHRoaXMtPmF0dHMsICRjb250ZW50ICk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJJG91dHB1dCAuPSAkdGhpcy0+YmVmb3JlU2hvcnRjb2RlKCAkdGhpcy0+YXR0cywgJGNvbnRlbnQgKTsNCgkJCQl9DQoJCQkJLy8gU2hvcnRjb2RlIGNvbnRlbnQNCgkJCQlpZiAoIGZ1bmN0aW9uX2V4aXN0cyggJGN1c3RvbV9vdXRwdXQgKSApIHsNCgkJCQkJJG91dHB1dCAuPSAkY3VzdG9tX291dHB1dCggJHRoaXMtPmF0dHMsICRjb250ZW50ICk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJJG91dHB1dCAuPSAkdGhpcy0+Y29udGVudCggJHRoaXMtPmF0dHMsICRjb250ZW50ICk7DQoJCQkJfQ0KCQkJCS8vIEFmdGVyIHNob3J0Y29kZQ0KCQkJCWlmICggZnVuY3Rpb25fZXhpc3RzKCAkY3VzdG9tX291dHB1dF9hZnRlciApICkgew0KCQkJCQkkb3V0cHV0IC49ICRjdXN0b21fb3V0cHV0X2FmdGVyKCAkdGhpcy0+YXR0cywgJGNvbnRlbnQgKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQkkb3V0cHV0IC49ICR0aGlzLT5hZnRlclNob3J0Y29kZSggJHRoaXMtPmF0dHMsICRjb250ZW50ICk7DQoJCQkJfQ0KDQoJCQkJLy8gRmlsdGVyIGZvciBvdmVycmlkaW5nIG91dHB1dHMNCgkJCQkkb3V0cHV0ID0gYXBwbHlfZmlsdGVycyggJ3ZjX3Nob3J0Y29kZV9vdXRwdXQnLCAkb3V0cHV0LCAkdGhpcyApOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJG91dHB1dDsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBDcmVhdGVzIGh0bWwgYmVmb3JlIHNob3J0Y29kZSBodG1sLg0KCQkgKg0KCQkgKiBAcGFyYW0gJGF0dHMgICAgLSBzaG9ydGNvZGUgYXR0cmlidXRlcyBsaXN0DQoJCSAqIEBwYXJhbSAkY29udGVudCAtIHNob3J0Y29kZSBjb250ZW50DQoJCSAqIEByZXR1cm4gc3RyaW5nIC0gaHRtbCB3aGljaCB3aWxsIGJlIGRpc3BsYXllZCBiZWZvcmUgc2hvcnRjb2RlIGh0bWwuDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gYmVmb3JlU2hvcnRjb2RlKCAkYXR0cywgJGNvbnRlbnQgKSB7DQoJCQlyZXR1cm4gJyc7DQoJCX0NCg0KCQkvKioNCgkJICogQ3JlYXRlcyBodG1sIGJlZm9yZSBzaG9ydGNvZGUgaHRtbC4NCgkJICoNCgkJICogQHBhcmFtICRhdHRzICAgIC0gc2hvcnRjb2RlIGF0dHJpYnV0ZXMgbGlzdA0KCQkgKiBAcGFyYW0gJGNvbnRlbnQgLSBzaG9ydGNvZGUgY29udGVudA0KCQkgKiBAcmV0dXJuIHN0cmluZyAtIGh0bWwgd2hpY2ggd2lsbCBiZSBkaXNwbGF5ZWQgYWZ0ZXIgc2hvcnRjb2RlIGh0bWwuDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gYWZ0ZXJTaG9ydGNvZGUoICRhdHRzLCAkY29udGVudCApIHsNCgkJCXJldHVybiAnJzsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBnZXRFeHRyYUNsYXNzKCAkZWxfY2xhc3MgKSB7DQoJCQkkb3V0cHV0ID0gJyc7DQoJCQlpZiAoICRlbF9jbGFzcyAhPSAnJyApIHsNCgkJCQkkb3V0cHV0ID0gIiAiIC4gc3RyX3JlcGxhY2UoICIuIiwgIiIsICRlbF9jbGFzcyApOw0KCQkJfQ0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gZ2V0Q1NTQW5pbWF0aW9uKCAkY3NzX2FuaW1hdGlvbiApIHsNCgkJCSRvdXRwdXQgPSAnJzsNCgkJCWlmICggJGNzc19hbmltYXRpb24gIT0gJycgKSB7DQoJCQkJd3BfZW5xdWV1ZV9zY3JpcHQoICd3YXlwb2ludHMnICk7DQoJCQkJJG91dHB1dCA9ICcgd3BiX2FuaW1hdGVfd2hlbl9hbG1vc3RfdmlzaWJsZSB3cGJfJyAuICRjc3NfYW5pbWF0aW9uOw0KCQkJfQ0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQkvKioNCgkJICogQ3JlYXRlIEhUTUwgY29tbWVudCBmb3IgYmxvY2tzDQoJCSAqDQoJCSAqIEBwYXJhbSAkc3RyaW5nDQoJCSAqDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gZW5kQmxvY2tDb21tZW50KCAkc3RyaW5nICkgew0KCQkJLy9yZXR1cm4gJyc7DQoJCQlyZXR1cm4gKCAhIGVtcHR5KCAkX0dFVFsnd3BiX2RlYnVnJ10gKSAmJiAkX0dFVFsnd3BiX2RlYnVnJ10gPT0gJ3RydWUnID8gJzwhLS0gRU5EICcgLiAkc3RyaW5nIC4gJyAtLT4nIDogJycgKTsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBTdGFydCByb3cgY29tbWVudCBmb3IgaHRtbCBzaG9ydGNvZGUgYmxvY2sNCgkJICoNCgkJICogQHBhcmFtICRwb3NpdGlvbiAtIGJsb2NrIHBvc2l0aW9uDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gc3RhcnRSb3coICRwb3NpdGlvbiApIHsNCgkJCSRvdXRwdXQgPSAnJzsNCgkJCXJldHVybiAnJzsNCgkJfQ0KDQoJCS8qKg0KCQkgKiBFbmQgcm93IGNvbW1lbnQgZm9yIGh0bWwgc2hvcnRjb2RlIGJsb2NrDQoJCSAqDQoJCSAqIEBwYXJhbSAkcG9zaXRpb24gLWJsb2NrIHBvc2l0aW9uDQoJCSAqIEByZXR1cm4gc3RyaW5nDQoJCSAqLw0KDQoJCXB1YmxpYyBmdW5jdGlvbiBlbmRSb3coICRwb3NpdGlvbiApIHsNCgkJCSRvdXRwdXQgPSAnJzsNCgkJCXJldHVybiAnJzsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBzZXR0aW5ncyggJG5hbWUgKSB7DQoJCQlyZXR1cm4gaXNzZXQoICR0aGlzLT5zZXR0aW5nc1skbmFtZV0gKSA/ICR0aGlzLT5zZXR0aW5nc1skbmFtZV0gOiBudWxsOw0KCQl9DQoJCXB1YmxpYyBmdW5jdGlvbiBzZXRTZXR0aW5ncyggJG5hbWUsICR2YWx1ZSApIHsNCgkJCSR0aGlzLT5zZXR0aW5nc1skbmFtZV0gPSAkdmFsdWU7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gZ2V0RWxlbWVudEhvbGRlciggJHdpZHRoICkgew0KCQkJJG91dHB1dCA9ICcnOw0KICAgICAgICAgICAgJGNvbHVtbl9jb250cm9scyA9ICR0aGlzLT5nZXRDb2x1bW5Db250cm9sc01vZHVsYXIoKTsNCgkJCSRjc3NfY2xhc3MgPSAnd3BiXycgLiAkdGhpcy0+c2V0dGluZ3NbImJhc2UiXSAuICcgd3BiX2NvbnRlbnRfZWxlbWVudCB3cGJfc29ydGFibGUnIC4gKCAhIGVtcHR5KCAkdGhpcy0+c2V0dGluZ3NbImNsYXNzIl0gKSA/ICcgJyAuICR0aGlzLT5zZXR0aW5nc1siY2xhc3MiXSA6ICcnICk7DQoJCQkkb3V0cHV0IC49ICc8ZGl2IGRhdGEtZWxlbWVudF90eXBlPSInIC4gJHRoaXMtPnNldHRpbmdzWyJiYXNlIl0gLiAnIiBjbGFzcz0iJyAuICRjc3NfY2xhc3MgLiAnIj4nOw0KCQkJJG91dHB1dCAuPSBzdHJfcmVwbGFjZSggIiVjb2x1bW5fc2l6ZSUiLCB3cGJfdHJhbnNsYXRlQ29sdW1uV2lkdGhUb0ZyYWN0aW9uYWwoICR3aWR0aCApLCAkY29sdW1uX2NvbnRyb2xzICk7DQoJCQkkb3V0cHV0IC49ICR0aGlzLT5nZXRDYWxsYmFja3MoICR0aGlzLT5zaG9ydGNvZGUgKTsNCgkJCSRvdXRwdXQgLj0gJzxkaXYgY2xhc3M9IndwYl9lbGVtZW50X3dyYXBwZXIgJyAuICR0aGlzLT5zZXR0aW5ncyggIndyYXBwZXJfY2xhc3MiICkgLiAnIj4nOw0KCQkJJG91dHB1dCAuPSAnJXdwYl9lbGVtZW50X2NvbnRlbnQlJzsNCgkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7IC8vIDwhLS0gZW5kIC53cGJfZWxlbWVudF93cmFwcGVyIC0tPic7DQoJCQkkb3V0cHV0IC49ICc8L2Rpdj4nOyAvLyA8IS0tIGVuZCAjZWxlbWVudC0nLiR0aGlzLT5zaG9ydGNvZGUuJyAtLT4nOw0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQkvKiBUaGlzIHJldHVycyBibG9jayBjb250cm9scw0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KCQlwdWJsaWMgZnVuY3Rpb24gZ2V0Q29sdW1uQ29udHJvbHMoICRjb250cm9scywgJGV4dGVuZGVkX2NzcyA9ICcnICkgew0KICAgICAgICAgICAgJGNvbnRyb2xzX3N0YXJ0ID0gJzxkaXYgY2xhc3M9InZjX2NvbnRyb2xzIGNvbnRyb2xzIGNvbnRyb2xzX2VsZW1lbnQnLighZW1wdHkoJGV4dGVuZGVkX2NzcykgPyAiIHskZXh0ZW5kZWRfY3NzfSIgOiAnJykuJyI+JzsNCgkJCSRjb250cm9sc19lbmQgPSAnPC9kaXY+JzsNCg0KCQkJJGNvbnRyb2xzX2FkZCA9ICcnOyAvLycgPGEgY2xhc3M9ImNvbHVtbl9hZGQiIGhyZWY9IiMiIHRpdGxlPSInLnNwcmludGYoX18oJ0FkZCB0byAlcycsICdqc19jb21wb3NlcicpLCBzdHJ0b2xvd2VyKCR0aGlzLT5zZXR0aW5ncygnbmFtZScpKSkuJyI+PC9hPic7DQogICAgICAgICAgICAkY29udHJvbHNfZWRpdCA9ICcgPGEgY2xhc3M9InZjX2NvbnRyb2wgY29sdW1uX2VkaXQiIGhyZWY9IiMiIHRpdGxlPSInLnNwcmludGYoX18oJ0VkaXQgJXMnLCAnanNfY29tcG9zZXInKSwgc3RydG9sb3dlcigkdGhpcy0+c2V0dGluZ3MoJ25hbWUnKSkpLiciPjxzcGFuIGNsYXNzPSJ2Y19pY29uIj48L3NwYW4+PC9hPic7DQogICAgICAgICAgICAkY29udHJvbHNfZGVsZXRlID0gJyA8YSBjbGFzcz0idmNfY29udHJvbCBjb2x1bW5fY2xvbmUiIGhyZWY9IiMiIHRpdGxlPSInLnNwcmludGYoX18oJ0Nsb25lICVzJywgJ2pzX2NvbXBvc2VyJyksIHN0cnRvbG93ZXIoJHRoaXMtPnNldHRpbmdzKCduYW1lJykpKS4nIj48c3BhbiBjbGFzcz0idmNfaWNvbiI+PC9zcGFuPjwvYT4gPGEgY2xhc3M9ImNvbHVtbl9kZWxldGUiIGhyZWY9IiMiIHRpdGxlPSInLnNwcmludGYoX18oJ0RlbGV0ZSAlcycsICdqc19jb21wb3NlcicpLCBzdHJ0b2xvd2VyKCR0aGlzLT5zZXR0aW5ncygnbmFtZScpKSkuJyI+PHNwYW4gY2xhc3M9InZjX2ljb24iPjwvc3Bhbj48L2E+JzsNCg0KCQkJJGNvbHVtbl9jb250cm9sc19mdWxsID0gJGNvbnRyb2xzX3N0YXJ0IC4gJGNvbnRyb2xzX2FkZCAuICRjb250cm9sc19lZGl0IC4gJGNvbnRyb2xzX2RlbGV0ZSAuICRjb250cm9sc19lbmQ7DQoJCQkkY29sdW1uX2NvbnRyb2xzX3NpemVfZGVsZXRlID0gJGNvbnRyb2xzX3N0YXJ0IC4gJGNvbnRyb2xzX2RlbGV0ZSAuICRjb250cm9sc19lbmQ7DQoJCQkkY29sdW1uX2NvbnRyb2xzX3BvcHVwX2RlbGV0ZSA9ICRjb250cm9sc19zdGFydCAuICRjb250cm9sc19kZWxldGUgLiAkY29udHJvbHNfZW5kOw0KCQkJJGNvbHVtbl9jb250cm9sc19lZGl0X3BvcHVwX2RlbGV0ZSA9ICRjb250cm9sc19zdGFydCAuICRjb250cm9sc19lZGl0IC4gJGNvbnRyb2xzX2RlbGV0ZSAuICRjb250cm9sc19lbmQ7DQoNCgkJCWlmICggJGNvbnRyb2xzID09ICdwb3B1cF9kZWxldGUnICkgew0KCQkJCXJldHVybiAkY29sdW1uX2NvbnRyb2xzX3BvcHVwX2RlbGV0ZTsNCgkJCX0gZWxzZSBpZiAoICRjb250cm9scyA9PSAnZWRpdF9wb3B1cF9kZWxldGUnICkgew0KCQkJCXJldHVybiAkY29sdW1uX2NvbnRyb2xzX2VkaXRfcG9wdXBfZGVsZXRlOw0KCQkJfSBlbHNlIGlmICggJGNvbnRyb2xzID09ICdzaXplX2RlbGV0ZScgKSB7DQoJCQkJcmV0dXJuICRjb2x1bW5fY29udHJvbHNfc2l6ZV9kZWxldGU7DQoJCQl9IGVsc2UgaWYgKCAkY29udHJvbHMgPT0gJ3BvcHVwX2RlbGV0ZScgKSB7DQoJCQkJcmV0dXJuICRjb2x1bW5fY29udHJvbHNfcG9wdXBfZGVsZXRlOw0KCQkJfSBlbHNlIGlmICggJGNvbnRyb2xzID09ICdhZGQnICkgew0KCQkJCXJldHVybiAkY29udHJvbHNfc3RhcnQgLiAkY29udHJvbHNfYWRkIC4gJGNvbnRyb2xzX2VuZDsNCgkJCX0gZWxzZSB7DQoJCQkJcmV0dXJuICRjb2x1bW5fY29udHJvbHNfZnVsbDsNCgkJCX0NCgkJfQ0KDQoJCS8qKg0KCQkgKiBCdWlsZCBuZXcgbW9kZXJuIGNvbnRyb2xzIGZvciBzaG9ydGNvZGUuDQoJCSAqDQoJCSAqIEBwYXJhbSBzdHJpbmcgJHBvc2l0aW9uIC0geSx4IHBvc2l0aW9uIHdoZXJlIHRvIHB1dCBjb250cm9scyBpbnNpZGUgYmxvY2sNCgkJICogCVBvc3NpYmxlICRwb3NpdGlvbiB2YWx1ZXMNCgkJICogCWNjIC0gY2VudGVyIGNlbnRlciBwb3NpdGlvbiBvZiB0aGUgYmxvY2sNCgkJICogCXRsIC0gdG9wIGxlZnQNCgkJICogCXRyIC0gdG9wIHJpZ2h0DQoJCSAqIAliciAtIGJvdHRvbSByaWdodA0KCQkgKiBAcGFyYW0gc3RyaW5nICRleHRlbmRlZF9jc3MNCgkJICogQHJldHVybiBzdHJpbmcNCgkJICovDQoJCXB1YmxpYyBmdW5jdGlvbiBnZXRDb2x1bW5Db250cm9sc01vZHVsYXIoJGV4dGVuZGVkX2NzcyA9ICcnKSB7DQoJCQlvYl9zdGFydCgpOw0KCQkJdmNfaW5jbHVkZV90ZW1wbGF0ZSgkdGhpcy0+Y29udHJvbHNfdGVtcGxhdGVfZmlsZSwgYXJyYXkoDQoJCQkJJ3Bvc2l0aW9uJyA9PiAkdGhpcy0+Y29udHJvbHNfY3NzX3NldHRpbmdzLA0KCQkJCSdleHRlbmRlZF9jc3MnID0+ICRleHRlbmRlZF9jc3MsDQoJCQkJJ25hbWUnID0+ICR0aGlzLT5zZXR0aW5ncygnbmFtZScpLA0KCQkJCSdjb250cm9scycgPT4gJHRoaXMtPmNvbnRyb2xzX2xpc3QNCgkJCSkpOw0KCQkJcmV0dXJuIG9iX2dldF9jbGVhbigpOw0KCQl9DQoJCS8qIFRoaXMgd2lsbCBmaXJlIGNhbGxiYWNrcyBpZiB0aGV5IGFyZSBkZWZpbmVkIGluIG1hcC5waHANCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCgkJcHVibGljIGZ1bmN0aW9uIGdldENhbGxiYWNrcyggJGlkICkgew0KCQkJJG91dHB1dCA9ICcnOw0KDQoJCQlpZiAoIGlzc2V0KCAkdGhpcy0+c2V0dGluZ3NbJ2pzX2NhbGxiYWNrJ10gKSApIHsNCgkJCQlmb3JlYWNoICggJHRoaXMtPnNldHRpbmdzWydqc19jYWxsYmFjayddIGFzICR0ZXh0X3ZhbCA9PiAkdmFsICkgew0KCQkJCQkvKiBUT0RPOiBuYW1lIGV4cGxhaW4gKi8NCgkJCQkJJG91dHB1dCAuPSAnPGlucHV0IHR5cGU9ImhpZGRlbiIgY2xhc3M9IndwYl92Y19jYWxsYmFjayB3cGJfdmNfJyAuICR0ZXh0X3ZhbCAuICdfY2FsbGJhY2sgIiBuYW1lPSInIC4gJHRleHRfdmFsIC4gJyIgdmFsdWU9IicgLiAkdmFsIC4gJyIgLz4nOw0KCQkJCX0NCgkJCX0NCg0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gc2luZ2xlUGFyYW1IdG1sSG9sZGVyKCAkcGFyYW0sICR2YWx1ZSApIHsNCgkJCSRvdXRwdXQgPSAnJzsNCgkJCS8vIENvbXBhdGliaWxpdHkgZml4ZXMNCgkJCSRvbGRfbmFtZXMgPSBhcnJheSggJ3llbGxvd19tZXNzYWdlJywgJ2JsdWVfbWVzc2FnZScsICdncmVlbl9tZXNzYWdlJywgJ2J1dHRvbl9ncmVlbicsICdidXR0b25fZ3JleScsICdidXR0b25feWVsbG93JywgJ2J1dHRvbl9ibHVlJywgJ2J1dHRvbl9yZWQnLCAnYnV0dG9uX29yYW5nZScgKTsNCgkJCSRuZXdfbmFtZXMgPSBhcnJheSggJ2FsZXJ0LWJsb2NrJywgJ2FsZXJ0LWluZm8nLCAnYWxlcnQtc3VjY2VzcycsICdidG4tc3VjY2VzcycsICdidG4nLCAnYnRuLWluZm8nLCAnYnRuLXByaW1hcnknLCAnYnRuLWRhbmdlcicsICdidG4td2FybmluZycgKTsNCgkJCSR2YWx1ZSA9IHN0cl9pcmVwbGFjZSggJG9sZF9uYW1lcywgJG5ld19uYW1lcywgJHZhbHVlICk7DQoJCQkvLyR2YWx1ZSA9IF9fKCR2YWx1ZSwgImpzX2NvbXBvc2VyIik7DQoJCQkvLw0KCQkJJHBhcmFtX25hbWUgPSBpc3NldCggJHBhcmFtWydwYXJhbV9uYW1lJ10gKSA/ICRwYXJhbVsncGFyYW1fbmFtZSddIDogJyc7DQoJCQkkdHlwZSA9IGlzc2V0KCAkcGFyYW1bJ3R5cGUnXSApID8gJHBhcmFtWyd0eXBlJ10gOiAnJzsNCgkJCSRjbGFzcyA9IGlzc2V0KCAkcGFyYW1bJ2NsYXNzJ10gKSA/ICRwYXJhbVsnY2xhc3MnXSA6ICcnOw0KCQkJaWYgKCAhIGVtcHR5KCAkcGFyYW1bJ2hvbGRlciddICkgKSB7DQoJCQkJaWYgKCAkcGFyYW1bJ2hvbGRlciddICE9PSAnaGlkZGVuJyApIHsNCgkJCQkJJG91dHB1dCAuPSAnPCcgLiAkcGFyYW1bJ2hvbGRlciddIC4gJyBjbGFzcz0id3BiX3ZjX3BhcmFtX3ZhbHVlICcgLiAkcGFyYW1fbmFtZSAuICcgJyAuICR0eXBlIC4gJyAnIC4gJGNsYXNzIC4gJyIgbmFtZT0iJyAuICRwYXJhbV9uYW1lIC4gJyI+JyAuICR2YWx1ZSAuICc8LycgLiAkcGFyYW1bJ2hvbGRlciddIC4gJz4nOw0KCQkJCX0gZWxzZWlmICggJHBhcmFtWydob2xkZXInXSA9PSAnaW5wdXQnICkgew0KCQkJCQkkb3V0cHV0IC49ICc8JyAuICRwYXJhbVsnaG9sZGVyJ10gLiAnIHJlYWRvbmx5PSJ0cnVlIiBjbGFzcz0id3BiX3ZjX3BhcmFtX3ZhbHVlICcgLiAkcGFyYW1fbmFtZSAuICcgJyAuICR0eXBlIC4gJyAnIC4gJGNsYXNzIC4gJyIgbmFtZT0iJyAuICRwYXJhbV9uYW1lIC4gJyIgdmFsdWU9IicgLiAkdmFsdWUgLiAnIj4nOw0KCQkJCX0gZWxzZWlmICggaW5fYXJyYXkoICRwYXJhbVsnaG9sZGVyJ10sIGFycmF5KCAnaW1nJywgJ2lmcmFtZScgKSApICkgew0KCQkJCQkkb3V0cHV0IC49ICc8JyAuICRwYXJhbVsnaG9sZGVyJ10gLiAnIGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgJyAuICRwYXJhbV9uYW1lIC4gJyAnIC4gJHR5cGUgLiAnICcgLiAkY2xhc3MgLiAnIiBuYW1lPSInIC4gJHBhcmFtX25hbWUgLiAnIiBzcmM9IicgLiAkdmFsdWUgLiAnIj4nOw0KCQkJCX0NCgkJCX0NCgkJCWlmICggISBlbXB0eSggJHBhcmFtWydhZG1pbl9sYWJlbCddICkgJiYgJHBhcmFtWydhZG1pbl9sYWJlbCddID09PSB0cnVlICkgew0KCQkJCSRvdXRwdXQgLj0gJzxzcGFuIGNsYXNzPSJ2Y19hZG1pbl9sYWJlbCBhZG1pbl9sYWJlbF8nIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAoIGVtcHR5KCAkdmFsdWUgKSA/ICcgaGlkZGVuLWxhYmVsJyA6ICcnICkgLiAnIj48bGFiZWw+JyAuIF9fKCAkcGFyYW1bJ2hlYWRpbmcnXSwgJ2pzX2NvbXBvc2VyJyApIC4gJzwvbGFiZWw+OiAnIC4gJHZhbHVlIC4gJzwvc3Bhbj4nOw0KCQkJfQ0KDQoJCQlyZXR1cm4gJG91dHB1dDsNCgkJfQ0KDQoJCXByb3RlY3RlZCBmdW5jdGlvbiBvdXRwdXRUaXRsZSggJHRpdGxlICkgew0KCQkJJGljb24gPSAkdGhpcy0+c2V0dGluZ3MoJ2ljb24nKTsNCgkJCWlmKCBmaWx0ZXJfdmFyKCAkaWNvbiwgRklMVEVSX1ZBTElEQVRFX1VSTCApICkgJGljb24gPSAnJzsNCiAgICAgICAgICAgIHJldHVybiAgJzxoNCBjbGFzcz0id3BiX2VsZW1lbnRfdGl0bGUiPjxzcGFuIGNsYXNzPSJ2Y19lbGVtZW50LWljb24nLiggIWVtcHR5KCRpY29uKSA/ICcgJy4kaWNvbiA6ICcnICkuJyI+PC9zcGFuPiAnLmVzY19hdHRyKCR0aXRsZSkuJzwvaDQ+JzsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiB0ZW1wbGF0ZSggJGNvbnRlbnQgPSAnJyApIHsNCgkJCXJldHVybiAkdGhpcy0+Y29udGVudEFkbWluKCAkdGhpcy0+YXR0cywgJGNvbnRlbnQgKTsNCgkJfQ0KDQoJCXByb3RlY3RlZCBmdW5jdGlvbiBwcmVwYXJlQXR0cyggJGF0dHMgKSB7DQoJCQkkcmV0dXJuID0gYXJyYXkoKTsNCgkJCWlmICggaXNfYXJyYXkoICRhdHRzICkgKSB7DQoJCQkJZm9yZWFjaCAoICRhdHRzIGFzICRrZXkgPT4gJHZhbCApIHsNCgkJCQkJJHJldHVyblska2V5XSA9IHByZWdfcmVwbGFjZSggJy9cYFxgLycsICciJywgJHZhbCApOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiAkcmV0dXJuOw0KCQl9DQoJfQ0KfQ0KaWYgKCAhIGNsYXNzX2V4aXN0cyggJ1dQQmFrZXJ5U2hvcnRDb2RlX1VuaXZlcnNhbEFkbWluJyApICkgew0KCWFic3RyYWN0IGNsYXNzIFdQQmFrZXJ5U2hvcnRDb2RlX1VuaXZlcnNhbEFkbWluIGV4dGVuZHMgV1BCYWtlcnlTaG9ydENvZGUgew0KCQlwcm90ZWN0ZWQgJGh0bWxfZWRpdG9yX2FscmVhZHlfaXNfdXNlZCA9IGZhbHNlOw0KDQoJCXB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCggJHNldHRpbmdzICkgew0KCQkJJHRoaXMtPnNldHRpbmdzID0gJHNldHRpbmdzOw0KCQkJJHRoaXMtPmFkZFNob3J0Q29kZSggJHRoaXMtPnNldHRpbmdzWydiYXNlJ10sIEFycmF5KCAkdGhpcywgJ291dHB1dCcgKSApOw0KCQl9DQoNCgkJcHJvdGVjdGVkIGZ1bmN0aW9uIGNvbnRlbnQoICRhdHRzLCAkY29udGVudCA9IG51bGwgKSB7DQoJCQlyZXR1cm4gJyc7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gY29udGVudEFkbWluKCAkYXR0cywgJGNvbnRlbnQgKSB7DQoNCgkJCSRvdXRwdXQgPSAnJzsNCgkJCSR0aGlzLT5sb2FkUGFyYW1zKCk7DQoJCQkvL2lmICggJGNvbnRlbnQgIT0gTlVMTCApIHsgJGNvbnRlbnQgPSBhcHBseV9maWx0ZXJzKCd0aGVfY29udGVudCcsICRjb250ZW50KTsgfQ0KCQkJJGNvbnRlbnQgPSAkZWxfcG9zaXRpb24gPSAnJzsNCgkJCWlmICggaXNzZXQoICR0aGlzLT5zZXR0aW5nc1sncGFyYW1zJ10gKSApIHsNCgkJCQkkc2hvcnRjb2RlX2F0dHJpYnV0ZXMgPSBhcnJheSgpOw0KCQkJCWZvcmVhY2ggKCAkdGhpcy0+c2V0dGluZ3NbJ3BhcmFtcyddIGFzICRwYXJhbSApIHsNCgkJCQkJaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSAhPSAnY29udGVudCcgKSB7DQoJCQkJCQkkc2hvcnRjb2RlX2F0dHJpYnV0ZXNbJHBhcmFtWydwYXJhbV9uYW1lJ11dID0gJHBhcmFtWyd2YWx1ZSddOw0KCQkJCQl9IGVsc2UgaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSA9PSAnY29udGVudCcgJiYgJGNvbnRlbnQgPT09IG51bGwgKSB7DQoJCQkJCQkkY29udGVudCA9ICRwYXJhbVsndmFsdWUnXTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlleHRyYWN0KCBzaG9ydGNvZGVfYXR0cygNCgkJCQkJJHNob3J0Y29kZV9hdHRyaWJ1dGVzDQoJCQkJCSwgJGF0dHMgKSApOw0KICAgICAgICAgICAgICAgICRlZGl0b3JfY3NzX2NsYXNzZXMgPSBhcHBseV9maWx0ZXJzKCd2Y19lZGl0X2Zvcm1fY2xhc3MnLCBhcnJheSgndmNfY29sLXNtLTEyJywgJ3dwYl9lZGl0X2Zvcm1fZWxlbWVudHMnKSk7DQoJCQkJJG91dHB1dCAuPSAnPGRpdiBjbGFzcz0iJyAuIGltcGxvZGUoICcgJywgJGVkaXRvcl9jc3NfY2xhc3NlcyApIC4gJyI+PGgyPicgLiBfXyggJ0VkaXQnLCAnanNfY29tcG9zZXInICkgLiAnICcgLiBfXyggJHRoaXMtPnNldHRpbmdzWyduYW1lJ10sICJqc19jb21wb3NlciIgKSAuICc8L2gyPic7DQoNCgkJCQlmb3JlYWNoICggJHRoaXMtPnNldHRpbmdzWydwYXJhbXMnXSBhcyAkcGFyYW0gKSB7DQoJCQkJCSRwYXJhbV92YWx1ZSA9IGlzc2V0KCAkJHBhcmFtWydwYXJhbV9uYW1lJ10gKSA/ICQkcGFyYW1bJ3BhcmFtX25hbWUnXSA6IG51bGw7DQoJCQkJCWlmICggaXNfYXJyYXkoICRwYXJhbV92YWx1ZSApICYmICEgZW1wdHkoICRwYXJhbVsndHlwZSddICkgJiYgJHBhcmFtWyd0eXBlJ10gIT0gJ2NoZWNrYm94JyApIHsNCgkJCQkJCS8vIEdldCBmaXJzdCBlbGVtZW50IGZyb20gdGhlIGFycmF5DQoJCQkJCQlyZXNldCggJHBhcmFtX3ZhbHVlICk7DQoJCQkJCQkkZmlyc3Rfa2V5ID0ga2V5KCAkcGFyYW1fdmFsdWUgKTsNCgkJCQkJCSRwYXJhbV92YWx1ZSA9ICRwYXJhbV92YWx1ZVskZmlyc3Rfa2V5XTsNCgkJCQkJfQ0KCQkJCQkkb3V0cHV0IC49ICR0aGlzLT5zaW5nbGVQYXJhbUVkaXRIb2xkZXIoICRwYXJhbSwgJHBhcmFtX3ZhbHVlICk7DQoJCQkJfQ0KDQoNCgkJCQkkb3V0cHV0IC49ICc8ZGl2IGNsYXNzPSJlZGl0X2Zvcm1fYWN0aW9ucyI+PGEgaHJlZj0iIyIgY2xhc3M9IndwYl9zYXZlX2VkaXRfZm9ybSBidXR0b24tcHJpbWFyeSI+JyAuIF9fKCAnU2F2ZScsICJqc19jb21wb3NlciIgKSAuICc8L2E+PC9kaXY+JzsNCg0KCQkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7IC8vY2xvc2Ugd3BiX2VkaXRfZm9ybV9lbGVtZW50cw0KCQkJfQ0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gc2luZ2xlUGFyYW1FZGl0SG9sZGVyKCAkcGFyYW0sICRwYXJhbV92YWx1ZSApIHsNCgkJCSRwYXJhbVsndmNfc2luZ2xlX3BhcmFtX2VkaXRfaG9sZGVyX2NsYXNzJ10gPSBhcnJheSggJ3dwYl9lbF90eXBlXycgLiAkcGFyYW1bJ3R5cGUnXSwgJ3ZjX3Nob3J0Y29kZS1wYXJhbScgKTsNCgkJCWlmICggISBlbXB0eSggJHBhcmFtWydwYXJhbV9ob2xkZXJfY2xhc3MnXSApICkgJHBhcmFtWyd2Y19zaW5nbGVfcGFyYW1fZWRpdF9ob2xkZXJfY2xhc3MnXVtdID0gJHBhcmFtWydwYXJhbV9ob2xkZXJfY2xhc3MnXTsNCgkJCSRwYXJhbSA9IGFwcGx5X2ZpbHRlcnMoICd2Y19zaW5nbGVfcGFyYW1fZWRpdCcsICRwYXJhbSApOw0KCQkJJG91dHB1dCA9ICc8ZGl2IGNsYXNzPSInIC4gaW1wbG9kZSggJyAnLCAkcGFyYW1bJ3ZjX3NpbmdsZV9wYXJhbV9lZGl0X2hvbGRlcl9jbGFzcyddICkgLiAnIj4nOw0KCQkJJG91dHB1dCAuPSAoIGlzc2V0KCAkcGFyYW1bJ2hlYWRpbmcnXSApICkgPyAnPGRpdiBjbGFzcz0id3BiX2VsZW1lbnRfbGFiZWwiPicgLiBfXyggJHBhcmFtWydoZWFkaW5nJ10sICJqc19jb21wb3NlciIgKSAuICc8L2Rpdj4nIDogJyc7DQogICAgICAgICAgICAkb3V0cHV0IC49ICc8ZGl2IGNsYXNzPSJlZGl0X2Zvcm1fbGluZSI+JzsNCgkJCSRvdXRwdXQgLj0gJHRoaXMtPnNpbmdsZVBhcmFtRWRpdEZvcm0oICRwYXJhbSwgJHBhcmFtX3ZhbHVlICk7DQogICAgICAgICAgICAkb3V0cHV0IC49IChpc3NldCgkcGFyYW1bJ2Rlc2NyaXB0aW9uJ10pKSA/ICc8c3BhbiBjbGFzcz0idmNfZGVzY3JpcHRpb24gdmNfY2xlYXJmaXgiPicuX18oJHBhcmFtWydkZXNjcmlwdGlvbiddLCAianNfY29tcG9zZXIiKS4nPC9zcGFuPicgOiAnJzsNCgkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7DQoJCQkkb3V0cHV0IC49ICc8L2Rpdj4nOw0KCQkJcmV0dXJuICRvdXRwdXQ7DQoJCX0NCg0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gc2luZ2xlUGFyYW1FZGl0Rm9ybSggJHBhcmFtLCAkcGFyYW1fdmFsdWUgKSB7DQoNCgkJCSRwYXJhbV9saW5lID0gJyc7DQoJCQkvLyBUZXh0ZmllbGQgLSBpbnB1dA0KCQkJaWYgKCAkcGFyYW1bJ3R5cGUnXSA9PSAndGV4dGZpZWxkJyApIHsNCgkJCQkkdmFsdWUgPSBfXyggJHBhcmFtX3ZhbHVlLCAianNfY29tcG9zZXIiICk7DQoJCQkJJHZhbHVlID0gaHRtbHNwZWNpYWxjaGFycyggJHZhbHVlICk7DQoJCQkJLy8kdmFsdWUgPSAkcGFyYW1fdmFsdWU7DQoJCQkJJHBhcmFtX2xpbmUgLj0gJzxpbnB1dCBuYW1lPSInIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAnIiBjbGFzcz0id3BiX3ZjX3BhcmFtX3ZhbHVlIHdwYi10ZXh0aW5wdXQgJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyAnIC4gJHBhcmFtWyd0eXBlJ10gLiAnIiB0eXBlPSJ0ZXh0IiB2YWx1ZT0iJyAuICR2YWx1ZSAuICciLz4nOw0KCQkJfSAvLyBEcm9wZG93biAtIHNlbGVjdA0KCQkJZWxzZSBpZiAoICRwYXJhbVsndHlwZSddID09ICdkcm9wZG93bicgKSB7DQoJCQkJJGNzc19vcHRpb24gPSB2Y19nZXRfZHJvcGRvd25fb3B0aW9uKCAkcGFyYW0sICRwYXJhbV92YWx1ZSApOw0KCQkJCSRwYXJhbV9saW5lIC49ICc8c2VsZWN0IG5hbWU9IicgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICciIGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgd3BiLWlucHV0IHdwYi1zZWxlY3QgJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyAnIC4gJHBhcmFtWyd0eXBlJ10gLiAnICcgLiAkY3NzX29wdGlvbiAuICciIGRhdGEtb3B0aW9uPSInIC4gJGNzc19vcHRpb24gLiAnIj4nOw0KCQkJCWZvcmVhY2ggKCAkcGFyYW1bJ3ZhbHVlJ10gYXMgJHRleHRfdmFsID0+ICR2YWwgKSB7DQoJCQkJCWlmICggaXNfbnVtZXJpYyggJHRleHRfdmFsICkgJiYgKCBpc19zdHJpbmcoICR2YWwgKSB8fCBpc19udW1lcmljKCAkdmFsICkgKSApIHsNCgkJCQkJCSR0ZXh0X3ZhbCA9ICR2YWw7DQoJCQkJCX0NCgkJCQkJJHRleHRfdmFsID0gX18oICR0ZXh0X3ZhbCwgImpzX2NvbXBvc2VyIiApOw0KCQkJCQkvLyR2YWwgPSBzdHJ0b2xvd2VyKHN0cl9yZXBsYWNlKGFycmF5KCIgIiksIGFycmF5KCJfIiksICR2YWwpKTsNCgkJCQkJLy8kdmFsID0gc3RydG9sb3dlcihzdHJfcmVwbGFjZShhcnJheSgiICIpLCBhcnJheSgiXyIpLCAkdmFsKSk7IC8vaXNzdWUgIzQ2NCBnaXRodWINCgkJCQkJJHNlbGVjdGVkID0gJyc7DQoJCQkJCWlmICggJHBhcmFtX3ZhbHVlICE9PSAnJyAmJiAoc3RyaW5nKSR2YWwgPT09IChzdHJpbmcpJHBhcmFtX3ZhbHVlICkgew0KCQkJCQkJJHNlbGVjdGVkID0gJyBzZWxlY3RlZD0ic2VsZWN0ZWQiJzsNCgkJCQkJfQ0KCQkJCQkkcGFyYW1fbGluZSAuPSAnPG9wdGlvbiBjbGFzcz0iJyAuICR2YWwgLiAnIiB2YWx1ZT0iJyAuICR2YWwgLiAnIicgLiAkc2VsZWN0ZWQgLiAnPicgLiBodG1sc3BlY2lhbGNoYXJzKCAkdGV4dF92YWwgKSAuICc8L29wdGlvbj4nOw0KCQkJCX0NCgkJCQkkcGFyYW1fbGluZSAuPSAnPC9zZWxlY3Q+JzsNCgkJCX0gLy8gV1lTSVdZRyBmaWVsZA0KCQkJZWxzZSBpZiAoICRwYXJhbVsndHlwZSddID09ICd0ZXh0YXJlYV9odG1sJyApIHsNCgkJCQlpZiAoICR0aGlzLT5odG1sX2VkaXRvcl9hbHJlYWR5X2lzX3VzZWQgIT09IGZhbHNlICkgew0KCQkJCQkkcGFyYW1fdmFsdWUgPSBfXyggJHBhcmFtX3ZhbHVlLCAianNfY29tcG9zZXIiICk7DQoJCQkJCSRwYXJhbV9saW5lIC49ICc8dGV4dGFyZWEgbmFtZT0iJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyIgY2xhc3M9IndwYl92Y19wYXJhbV92YWx1ZSB3cGItdGV4dGFyZWEgJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyB0ZXh0YXJlYSI+JyAuICRwYXJhbV92YWx1ZSAuICc8L3RleHRhcmVhPic7DQoJCQkJCSRwYXJhbV9saW5lIC49ICc8ZGl2IGNsYXNzPSJ1cGRhdGVkIj48cD4nIC4gX18oICdGaWVsZCB0eXBlIGlzIGNoYW5nZWQgZnJvbSBgdGV4dGFyZWFfaHRtbGAgdG8gYHRleHRhcmVhYCwgYmVjYXVzZSBpdCBpcyBhbHJlYWR5IHVzZWQgYnkgYCcgLiAkdGhpcy0+aHRtbF9lZGl0b3JfYWxyZWFkeV9pc191c2VkIC4gJ2AgZmllbGQuIFRleHRhcmVhX2h0bWwgZmllbGRcJ3MgdHlwZSBjYW4gYmUgdXNlZCBvbmx5IG9uY2UgcGVyIHNob3J0Y29kZS4nLCAnanNfY29tcG9zZXInICkgLiAnPC9wPjwvZGl2Pic7DQoJCQkJfSBlbHNlIHsNCgkJCQkJJHRoaXMtPmh0bWxfZWRpdG9yX2FscmVhZHlfaXNfdXNlZCA9ICRwYXJhbVsncGFyYW1fbmFtZSddOw0KCQkJCQkkcGFyYW1fbGluZSAuPSBkb19zaG9ydGNvZGVfcGFyYW1fc2V0dGluZ3NfZmllbGQoICd0ZXh0YXJlYV9odG1sJywgJHBhcmFtLCAkcGFyYW1fdmFsdWUgKTsNCgkJCQl9DQoJCQkJLy8gJHBhcmFtX2xpbmUgLj0gJHRoaXMtPmdldFRpbnlIdG1sVGV4dEFyZWEoJHBhcmFtLCAkcGFyYW1fdmFsdWUpOw0KCQkJfSAvLyBDaGVja2JveGVzIHdpdGggcG9zdCB0eXBlcw0KCQkJZWxzZSBpZiAoICRwYXJhbVsndHlwZSddID09ICdjaGVja2JveCcgKSB7DQoJCQkJLy8gcGFyYW1fbGluZSAuPSAnPGlucHV0IGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgd3BiLWNoZWNrYm94ZXMiIHR5cGU9ImhpZGRlbiIgdmFsdWU9IiIgbmFtZT0iJy4kcGFyYW1bJ3BhcmFtX25hbWUnXS4nIi8+JzsNCgkJCQkkY3VycmVudF92YWx1ZSA9IGV4cGxvZGUoICIsIiwgJHBhcmFtX3ZhbHVlICk7DQoJCQkJJHZhbHVlcyA9IGlzX2FycmF5KCAkcGFyYW1bJ3ZhbHVlJ10gKSA/ICRwYXJhbVsndmFsdWUnXSA6IGFycmF5KCk7DQoJCQkJZm9yZWFjaCAoICR2YWx1ZXMgYXMgJGxhYmVsID0+ICR2ICkgew0KCQkJCQkkY2hlY2tlZCA9IGluX2FycmF5KCAkdiwgJGN1cnJlbnRfdmFsdWUgKSA/ICcgY2hlY2tlZD0iY2hlY2tlZCInIDogJyc7DQoJCQkJCSRwYXJhbV9saW5lIC49ICcgPGlucHV0IGlkPSInIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAnLScgLiAkdiAuICciIHZhbHVlPSInIC4gJHYgLiAnIiBjbGFzcz0id3BiX3ZjX3BhcmFtX3ZhbHVlICcgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICcgJyAuICRwYXJhbVsndHlwZSddIC4gJyIgdHlwZT0iY2hlY2tib3giIG5hbWU9IicgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICciJyAuICRjaGVja2VkIC4gJz4gJyAuIF9fKCAkbGFiZWwsICJqc19jb21wb3NlciIgKTsNCgkJCQl9DQoJCQl9IGVsc2UgaWYgKCAkcGFyYW1bJ3R5cGUnXSA9PSAncG9zdHR5cGVzJyApIHsNCgkJCQkvLyAkcGFyYW1fbGluZSAuPSAnPGlucHV0IGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgd3BiLWNoZWNrYm94ZXMiIHR5cGU9ImhpZGRlbiIgdmFsdWU9IiIgbmFtZT0iJy4kcGFyYW1bJ3BhcmFtX25hbWUnXS4nIi8+JzsNCgkJCQkkYXJncyA9IGFycmF5KA0KCQkJCQkncHVibGljJyA9PiB0cnVlDQoJCQkJKTsNCgkJCQkkcG9zdF90eXBlcyA9IGdldF9wb3N0X3R5cGVzKCAkYXJncyApOw0KCQkJCWZvcmVhY2ggKCAkcG9zdF90eXBlcyBhcyAkcG9zdF90eXBlICkgew0KCQkJCQkkY2hlY2tlZCA9ICIiOw0KCQkJCQlpZiAoICRwb3N0X3R5cGUgIT0gJ2F0dGFjaG1lbnQnICkgew0KCQkJCQkJaWYgKCBpbl9hcnJheSggJHBvc3RfdHlwZSwgZXhwbG9kZSggIiwiLCAkcGFyYW1fdmFsdWUgKSApICkgJGNoZWNrZWQgPSAnIGNoZWNrZWQ9ImNoZWNrZWQiJzsNCgkJCQkJCSRwYXJhbV9saW5lIC49ICcgPGlucHV0IGlkPSInIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAnLScgLiAkcG9zdF90eXBlIC4gJyIgdmFsdWU9IicgLiAkcG9zdF90eXBlIC4gJyIgY2xhc3M9IndwYl92Y19wYXJhbV92YWx1ZSAnIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAnICcgLiAkcGFyYW1bJ3R5cGUnXSAuICciIHR5cGU9ImNoZWNrYm94IiBuYW1lPSInIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAnIicgLiAkY2hlY2tlZCAuICc+ICcgLiAkcG9zdF90eXBlOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSBlbHNlIGlmICggJHBhcmFtWyd0eXBlJ10gPT0gJ3RheG9ub21pZXMnIHx8ICRwYXJhbVsndHlwZSddID09ICd0YXhvbW9uaWVzJyApIHsNCgkJCQkvLyAkcGFyYW1fbGluZSAuPSAnPGlucHV0IGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgd3BiLWNoZWNrYm94ZXMiIHR5cGU9ImhpZGRlbiIgdmFsdWU9IiIgbmFtZT0iIi8+JzsNCgkJCQkkcG9zdF90eXBlcyA9IGdldF9wb3N0X3R5cGVzKCBhcnJheSggJ3B1YmxpYycgPT4gZmFsc2UsICduYW1lJyA9PiAnYXR0YWNobWVudCcgKSwgJ25hbWVzJywgJ05PVCcgKTsNCgkJCQlmb3JlYWNoICggJHBvc3RfdHlwZXMgYXMgJHR5cGUgKSB7DQoJCQkJCSR0YXhvbm9taWVzID0gZ2V0X29iamVjdF90YXhvbm9taWVzKCAkdHlwZSwgJycgKTsNCgkJCQkJZm9yZWFjaCAoICR0YXhvbm9taWVzIGFzICR0YXggKSB7DQoJCQkJCQkkY2hlY2tlZCA9ICIiOw0KCQkJCQkJaWYgKCBpbl9hcnJheSggJHRheC0+bmFtZSwgZXhwbG9kZSggIiwiLCAkcGFyYW1fdmFsdWUgKSApICkgJGNoZWNrZWQgPSAnIGNoZWNrZWQ9ImNoZWNrZWQiJzsNCgkJCQkJCSRwYXJhbV9saW5lIC49ICcgPGxhYmVsIGRhdGEtcG9zdC10eXBlPSInIC4gJHR5cGUgLiAnIj48aW5wdXQgaWQ9IicgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICctJyAuICR0YXgtPm5hbWUgLiAnIiB2YWx1ZT0iJyAuICR0YXgtPm5hbWUgLiAnIiBkYXRhLXBvc3QtdHlwZT0iJyAuICR0eXBlIC4gJyIgY2xhc3M9IndwYl92Y19wYXJhbV92YWx1ZSAnIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAnICcgLiAkcGFyYW1bJ3R5cGUnXSAuICciIHR5cGU9ImNoZWNrYm94IiBuYW1lPSInIC4gJHBhcmFtWydwYXJhbV9uYW1lJ10gLiAnIicgLiAkY2hlY2tlZCAuICc+ICcgLiAkdGF4LT5sYWJlbCAuICc8L2xhYmVsPic7DQoJCQkJCX0NCgkJCQl9DQoJCQl9IC8vIEV4cGxvZGVkIHRleHRhcmVhDQoJCQllbHNlIGlmICggJHBhcmFtWyd0eXBlJ10gPT0gJ2V4cGxvZGVkX3RleHRhcmVhJyApIHsNCgkJCQkkcGFyYW1fdmFsdWUgPSBzdHJfcmVwbGFjZSggIiwiLCAiXG4iLCAkcGFyYW1fdmFsdWUgKTsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPHRleHRhcmVhIG5hbWU9IicgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICciIGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgd3BiLXRleHRhcmVhICcgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICcgJyAuICRwYXJhbVsndHlwZSddIC4gJyI+JyAuICRwYXJhbV92YWx1ZSAuICc8L3RleHRhcmVhPic7DQoJCQl9IC8vIEJpZyBSZWd1bGFyIHRleHRhcmVhDQoJCQllbHNlIGlmICggJHBhcmFtWyd0eXBlJ10gPT0gJ3RleHRhcmVhX3Jhd19odG1sJyApIHsNCgkJCQkvLyAkcGFyYW1fdmFsdWUgPSBfXygkcGFyYW1fdmFsdWUsICJqc19jb21wb3NlciIpOw0KCQkJCSRwYXJhbV9saW5lIC49ICc8dGV4dGFyZWEgbmFtZT0iJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyIgY2xhc3M9IndwYl92Y19wYXJhbV92YWx1ZSB3cGItdGV4dGFyZWFfcmF3X2h0bWwgJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyAnIC4gJHBhcmFtWyd0eXBlJ10gLiAnIiByb3dzPSIxNiI+JyAuIGh0bWxlbnRpdGllcyggcmF3dXJsZGVjb2RlKCBiYXNlNjRfZGVjb2RlKCAkcGFyYW1fdmFsdWUgKSApLCBFTlRfQ09NUEFULCAnVVRGLTgnICkgLiAnPC90ZXh0YXJlYT4nOw0KCQkJfSAvLyBCaWcgUmVndWxhciB0ZXh0YXJlYQ0KCQkJZWxzZSBpZiAoICRwYXJhbVsndHlwZSddID09ICd0ZXh0YXJlYV9zYWZlJyApIHsNCgkJCQkvLyAkcGFyYW1fdmFsdWUgPSBfXygkcGFyYW1fdmFsdWUsICJqc19jb21wb3NlciIpOw0KCQkJCSRwYXJhbV9saW5lIC49ICc8dGV4dGFyZWEgbmFtZT0iJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyIgY2xhc3M9IndwYl92Y19wYXJhbV92YWx1ZSB3cGItdGV4dGFyZWFfcmF3X2h0bWwgJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyAnIC4gJHBhcmFtWyd0eXBlJ10gLiAnIj4nIC4gdmNfdmFsdWVfZnJvbV9zYWZlKCAkcGFyYW1fdmFsdWUsIHRydWUgKSAuICc8L3RleHRhcmVhPic7DQoJCQl9IC8vIFJlZ3VsYXIgdGV4dGFyZWENCgkJCWVsc2UgaWYgKCAkcGFyYW1bJ3R5cGUnXSA9PSAndGV4dGFyZWEnICkgew0KCQkJCSRwYXJhbV92YWx1ZSA9IF9fKCAkcGFyYW1fdmFsdWUsICJqc19jb21wb3NlciIgKTsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPHRleHRhcmVhIG5hbWU9IicgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICciIGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgd3BiLXRleHRhcmVhICcgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICcgJyAuICRwYXJhbVsndHlwZSddIC4gJyI+JyAuICRwYXJhbV92YWx1ZSAuICc8L3RleHRhcmVhPic7DQoJCQl9IC8vIEF0dGFjaCBpbWFnZXMNCgkJCWVsc2UgaWYgKCAkcGFyYW1bJ3R5cGUnXSA9PSAnYXR0YWNoX2ltYWdlcycgKSB7DQoJCQkJLy8gVE9ETzogTW9yZSBuYXRpdmUgd2F5DQoJCQkJJHBhcmFtX3ZhbHVlID0gd3BiX3JlbW92ZU5vdEV4aXN0aW5nSW1nSURzKCAkcGFyYW1fdmFsdWUgKTsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPGlucHV0IHR5cGU9ImhpZGRlbiIgY2xhc3M9IndwYl92Y19wYXJhbV92YWx1ZSBnYWxsZXJ5X3dpZGdldF9hdHRhY2hlZF9pbWFnZXNfaWRzICcgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICcgJyAuICRwYXJhbVsndHlwZSddIC4gJyIgbmFtZT0iJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyIgdmFsdWU9IicgLiAkcGFyYW1fdmFsdWUgLiAnIi8+JzsNCgkJCQkvLyRwYXJhbV9saW5lIC49ICc8YSBjbGFzcz0iYnV0dG9uIGdhbGxlcnlfd2lkZ2V0X2FkZF9pbWFnZXMiIGhyZWY9IiMiIHRpdGxlPSInLl9fKCdBZGQgaW1hZ2VzJywgImpzX2NvbXBvc2VyIikuJyI+Jy5fXygnQWRkIGltYWdlcycsICJqc19jb21wb3NlciIpLic8L2E+JzsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPGRpdiBjbGFzcz0iZ2FsbGVyeV93aWRnZXRfYXR0YWNoZWRfaW1hZ2VzIj4nOw0KCQkJCSRwYXJhbV9saW5lIC49ICc8dWwgY2xhc3M9ImdhbGxlcnlfd2lkZ2V0X2F0dGFjaGVkX2ltYWdlc19saXN0Ij4nOw0KCQkJCSRwYXJhbV9saW5lIC49ICggJHBhcmFtX3ZhbHVlICE9ICcnICkgPyBmaWVsZEF0dGFjaGVkSW1hZ2VzKCBleHBsb2RlKCAiLCIsICRwYXJhbV92YWx1ZSApICkgOiAnJzsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPC91bD4nOw0KCQkJCSRwYXJhbV9saW5lIC49ICc8L2Rpdj4nOw0KCQkJCSRwYXJhbV9saW5lIC49ICc8ZGl2IGNsYXNzPSJnYWxsZXJ5X3dpZGdldF9zaXRlX2ltYWdlcyI+JzsNCgkJCQkvLyAkcGFyYW1fbGluZSAuPSBzaXRlQXR0YWNoZWRJbWFnZXMoZXhwbG9kZSgiLCIsICRwYXJhbV92YWx1ZSkpOw0KCQkJCSRwYXJhbV9saW5lIC49ICc8L2Rpdj4nOw0KCQkJCSRwYXJhbV9saW5lIC49ICc8YSBjbGFzcz0iZ2FsbGVyeV93aWRnZXRfYWRkX2ltYWdlcyIgaHJlZj0iIyIgdGl0bGU9IicgLiBfXyggJ0FkZCBpbWFnZXMnLCAianNfY29tcG9zZXIiICkgLiAnIj4nIC4gX18oICdBZGQgaW1hZ2VzJywgImpzX2NvbXBvc2VyIiApIC4gJzwvYT4nOyAvL2NsYXNzOiBidXR0b24NCgkJCQkvLyRwYXJhbV9saW5lIC49ICc8ZGl2IGNsYXNzPSJ3cGJfY2xlYXIiPjwvZGl2Pic7DQoJCQl9IGVsc2UgaWYgKCAkcGFyYW1bJ3R5cGUnXSA9PSAnYXR0YWNoX2ltYWdlJyApIHsNCgkJCQkkcGFyYW1fdmFsdWUgPSB3cGJfcmVtb3ZlTm90RXhpc3RpbmdJbWdJRHMoIHByZWdfcmVwbGFjZSggJy9bXlxkXS8nLCAnJywgJHBhcmFtX3ZhbHVlICkgKTsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPGlucHV0IHR5cGU9ImhpZGRlbiIgY2xhc3M9IndwYl92Y19wYXJhbV92YWx1ZSBnYWxsZXJ5X3dpZGdldF9hdHRhY2hlZF9pbWFnZXNfaWRzICcgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICcgJyAuICRwYXJhbVsndHlwZSddIC4gJyIgbmFtZT0iJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyIgdmFsdWU9IicgLiAkcGFyYW1fdmFsdWUgLiAnIi8+JzsNCgkJCQkvLyRwYXJhbV9saW5lIC49ICc8YSBjbGFzcz0iYnV0dG9uIGdhbGxlcnlfd2lkZ2V0X2FkZF9pbWFnZXMiIGhyZWY9IiMiIHVzZS1zaW5nbGU9InRydWUiIHRpdGxlPSInLl9fKCdBZGQgaW1hZ2UnLCAianNfY29tcG9zZXIiKS4nIj4nLl9fKCdBZGQgaW1hZ2UnLCAianNfY29tcG9zZXIiKS4nPC9hPic7DQoJCQkJJHBhcmFtX2xpbmUgLj0gJzxkaXYgY2xhc3M9ImdhbGxlcnlfd2lkZ2V0X2F0dGFjaGVkX2ltYWdlcyI+JzsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPHVsIGNsYXNzPSJnYWxsZXJ5X3dpZGdldF9hdHRhY2hlZF9pbWFnZXNfbGlzdCI+JzsNCgkJCQkkcGFyYW1fbGluZSAuPSAoICRwYXJhbV92YWx1ZSAhPSAnJyApID8gZmllbGRBdHRhY2hlZEltYWdlcyggZXhwbG9kZSggIiwiLCAkcGFyYW1fdmFsdWUgKSApIDogJyc7DQoJCQkJJHBhcmFtX2xpbmUgLj0gJzwvdWw+JzsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPC9kaXY+JzsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPGRpdiBjbGFzcz0iZ2FsbGVyeV93aWRnZXRfc2l0ZV9pbWFnZXMiPic7DQoJCQkJLy8gJHBhcmFtX2xpbmUgLj0gc2l0ZUF0dGFjaGVkSW1hZ2VzKGV4cGxvZGUoIiwiLCAkcGFyYW1fdmFsdWUpKTsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPC9kaXY+JzsNCgkJCQkkcGFyYW1fbGluZSAuPSAnPGEgY2xhc3M9ImdhbGxlcnlfd2lkZ2V0X2FkZF9pbWFnZXMiIGhyZWY9IiMiIHVzZS1zaW5nbGU9InRydWUiIHRpdGxlPSInIC4gX18oICdBZGQgaW1hZ2UnLCAianNfY29tcG9zZXIiICkgLiAnIj4nIC4gX18oICdBZGQgaW1hZ2UnLCAianNfY29tcG9zZXIiICkgLiAnPC9hPic7IC8vY2xhc3M6IGJ1dHRvbg0KCQkJCS8vJHBhcmFtX2xpbmUgLj0gJzxkaXYgY2xhc3M9IndwYl9jbGVhciI+PC9kaXY+JzsNCgkJCX0gLy8NCgkJCWVsc2UgaWYgKCAkcGFyYW1bJ3R5cGUnXSA9PSAnd2lkZ2V0aXNlZF9zaWRlYmFycycgKSB7DQoJCQkJJHdwYl9zaWRlYmFyX2lkcyA9IEFycmF5KCk7DQoJCQkJJHNpZGViYXJzID0gJEdMT0JBTFNbJ3dwX3JlZ2lzdGVyZWRfc2lkZWJhcnMnXTsNCg0KCQkJCSRwYXJhbV9saW5lIC49ICc8c2VsZWN0IG5hbWU9IicgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICciIGNsYXNzPSJ3cGJfdmNfcGFyYW1fdmFsdWUgZHJvcGRvd24gd3BiLWlucHV0IHdwYi1zZWxlY3QgJyAuICRwYXJhbVsncGFyYW1fbmFtZSddIC4gJyAnIC4gJHBhcmFtWyd0eXBlJ10gLiAnIj4nOw0KCQkJCWZvcmVhY2ggKCAkc2lkZWJhcnMgYXMgJHNpZGViYXIgKSB7DQoJCQkJCSRzZWxlY3RlZCA9ICcnOw0KCQkJCQlpZiAoICRzaWRlYmFyWyJpZCJdID09ICRwYXJhbV92YWx1ZSApICRzZWxlY3RlZCA9ICcgc2VsZWN0ZWQ9InNlbGVjdGVkIic7DQoJCQkJCSRzaWRlYmFyX25hbWUgPSBfXyggJHNpZGViYXJbIm5hbWUiXSwgImpzX2NvbXBvc2VyIiApOw0KCQkJCQkkcGFyYW1fbGluZSAuPSAnPG9wdGlvbiB2YWx1ZT0iJyAuICRzaWRlYmFyWyJpZCJdIC4gJyInIC4gJHNlbGVjdGVkIC4gJz4nIC4gJHNpZGViYXJfbmFtZSAuICc8L29wdGlvbj4nOw0KCQkJCX0NCgkJCQkkcGFyYW1fbGluZSAuPSAnPC9zZWxlY3Q+JzsNCgkJCX0gZWxzZSB7DQoJCQkJJHBhcmFtX2xpbmUgLj0gZG9fc2hvcnRjb2RlX3BhcmFtX3NldHRpbmdzX2ZpZWxkKCAkcGFyYW1bJ3R5cGUnXSwgJHBhcmFtLCAkcGFyYW1fdmFsdWUgKTsNCgkJCX0NCg0KDQoJCQlyZXR1cm4gJHBhcmFtX2xpbmU7DQoJCX0NCg0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0VGlueUh0bWxUZXh0QXJlYSggJHBhcmFtID0gYXJyYXkoKSwgJHBhcmFtX3ZhbHVlICkgew0KCQkJJHBhcmFtX2xpbmUgPSAnJzsNCg0KCQkJLy8kdXBsb2FkX21lZGlhX2J0bnMgPSAnPGRpdiBjbGFzcz0id3BiX21lZGlhLWJ1dHRvbnMgaGlkZS1pZi1uby1qcyI+ICcuX18oJ1VwbG9hZC9JbnNlcnQnKS4nIDxhIHRpdGxlPSInLl9fKCdBZGQgYW4gSW1hZ2UnKS4nIiBjbGFzcz0id3BiX2luc2VydC1pbWFnZSIgaHJlZj0iIyI+PGltZyBhbHQ9IicuX18oJ0FkZCBhbiBJbWFnZScpLiciIHNyYz0iJy5ob21lX3VybCgpLicvd3AtYWRtaW4vaW1hZ2VzL21lZGlhLWJ1dHRvbi1pbWFnZS5naWYiPjwvYT4gPGEgY2xhc3M9IndwYl9zd2l0Y2gtZWRpdG9ycyIgdGl0bGU9IicuX18oJ1N3aXRjaCBFZGl0b3JzJykuJyIgaHJlZj0iIyI+SFRNTCBtb2RlPC9hPjwvZGl2Pic7DQoNCgkJCWlmICggZnVuY3Rpb25fZXhpc3RzKCAnd3BfZWRpdG9yJyApICkgew0KCQkJCSRkZWZhdWx0X2NvbnRlbnQgPSBfXyggJHBhcmFtX3ZhbHVlLCAianNfY29tcG9zZXIiICk7DQoJCQkJJG91dHB1dF92YWx1ZSA9ICcnOw0KCQkJCS8vIFdQIDMuMysNCgkJCQlvYl9zdGFydCgpOw0KCQkJCXdwX2VkaXRvciggJGRlZmF1bHRfY29udGVudCwgJ3dwYl90aW55bWNlXycgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSwgYXJyYXkoICdlZGl0b3JfY2xhc3MnID0+ICd3cGJfdmNfcGFyYW1fdmFsdWUgd3BiLXRleHRhcmVhIHZpc3VhbF9jb21wb3Nlcl90aW55bWNlICcgLiAkcGFyYW1bJ3BhcmFtX25hbWUnXSAuICcgJyAuICRwYXJhbVsndHlwZSddLCAnbWVkaWFfYnV0dG9ucycgPT4gdHJ1ZSwgJ3dwYXV0b3AnID0+IHRydWUgKSApOw0KCQkJCSRvdXRwdXRfdmFsdWUgPSBvYl9nZXRfY29udGVudHMoKTsNCgkJCQlvYl9lbmRfY2xlYW4oKTsNCgkJCQkkcGFyYW1fbGluZSAuPSAkb3V0cHV0X3ZhbHVlOw0KCQkJfQ0KCQkJcmV0dXJuICRwYXJhbV9saW5lOw0KCQl9DQoJfQ0KfQ0KaWYgKCAhIGNsYXNzX2V4aXN0cyggJ1dQQmFrZXJ5U2hvcnRDb2Rlc0NvbnRhaW5lcicgKSApIHsNCglhYnN0cmFjdCBjbGFzcyBXUEJha2VyeVNob3J0Q29kZXNDb250YWluZXIgZXh0ZW5kcyBXUEJha2VyeVNob3J0Q29kZSB7DQoJCXByb3RlY3RlZCAkcHJlZGVmaW5lZF9hdHRzID0gYXJyYXkoDQoJCSk7DQoNCgkJcHVibGljIGZ1bmN0aW9uIGN1c3RvbUFkbWluQmxvY2tQYXJhbXMoKSB7DQoJCQlyZXR1cm4gJyc7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gbWFpbkh0bWxCbG9ja1BhcmFtcyggJHdpZHRoLCAkaSApIHsNCgkJCXJldHVybiAnZGF0YS1lbGVtZW50X3R5cGU9IicgLiAkdGhpcy0+c2V0dGluZ3NbImJhc2UiXSAuICciIGNsYXNzPSJ3cGJfJyAuICR0aGlzLT5zZXR0aW5nc1snYmFzZSddIC4gJyB3cGJfc29ydGFibGUgd3BiX2NvbnRlbnRfaG9sZGVyIHZjX3Nob3J0Y29kZXNfY29udGFpbmVyIicgLiAkdGhpcy0+Y3VzdG9tQWRtaW5CbG9ja1BhcmFtcygpOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGNvbnRhaW5lckh0bWxCbG9ja1BhcmFtcyggJHdpZHRoLCAkaSApIHsNCgkJCXJldHVybiAnY2xhc3M9IndwYl9jb2x1bW5fY29udGFpbmVyIHZjX2NvbnRhaW5lcl9mb3JfY2hpbGRyZW4iJzsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBnZXRDb2x1bW5Db250cm9scyggJGNvbnRyb2xzLCAkZXh0ZW5kZWRfY3NzID0gJycgKSB7DQoJCQkkY29udHJvbHNfc3RhcnQgPSAnPGRpdiBjbGFzcz0idmNfY29udHJvbHMgdmNfY29udHJvbHMtdmlzaWJsZSBjb250cm9scyBjb250cm9sc19jb2x1bW4nIC4gKCAhIGVtcHR5KCAkZXh0ZW5kZWRfY3NzICkgPyAiIHskZXh0ZW5kZWRfY3NzfSIgOiAnJyApIC4gJyI+JzsNCgkJCSRjb250cm9sc19lbmQgPSAnPC9kaXY+JzsNCg0KCQkJaWYgKCAkZXh0ZW5kZWRfY3NzID09ICdib3R0b20tY29udHJvbHMnICkgJGNvbnRyb2xfdGl0bGUgPSBzcHJpbnRmKCBfXyggJ0FwcGVuZCB0byB0aGlzICVzJywgJ2pzX2NvbXBvc2VyJyApLCBzdHJ0b2xvd2VyKCAkdGhpcy0+c2V0dGluZ3MoICduYW1lJyApICkgKTsNCgkJCWVsc2UgJGNvbnRyb2xfdGl0bGUgPSBzcHJpbnRmKCBfXyggJ1ByZXBlbmQgdG8gdGhpcyAlcycsICdqc19jb21wb3NlcicgKSwgc3RydG9sb3dlciggJHRoaXMtPnNldHRpbmdzKCAnbmFtZScgKSApICk7DQoNCgkJCSRjb250cm9sc19hZGQgPSAnIDxhIGNsYXNzPSJ2Y19jb250cm9sIGNvbHVtbl9hZGQiIGhyZWY9IiMiIHRpdGxlPSInIC4gJGNvbnRyb2xfdGl0bGUgLiAnIj48c3BhbiBjbGFzcz0idmNfaWNvbiI+PC9zcGFuPjwvYT4nOw0KCQkJJGNvbnRyb2xzX2VkaXQgPSAnIDxhIGNsYXNzPSJ2Y19jb250cm9sIGNvbHVtbl9lZGl0IiBocmVmPSIjIiB0aXRsZT0iJyAuIHNwcmludGYoIF9fKCAnRWRpdCB0aGlzICVzJywgJ2pzX2NvbXBvc2VyJyApLCBzdHJ0b2xvd2VyKCAkdGhpcy0+c2V0dGluZ3MoICduYW1lJyApICkgKSAuICciPjxzcGFuIGNsYXNzPSJ2Y19pY29uIj48L3NwYW4+PC9hPic7DQoJCQkkY29udHJvbHNfY2xvbmUgPSAnPGEgY2xhc3M9InZjX2NvbnRyb2wgY29sdW1uX2Nsb25lIiBocmVmPSIjIiB0aXRsZT0iJyAuIHNwcmludGYoIF9fKCAnQ2xvbmUgdGhpcyAlcycsICdqc19jb21wb3NlcicgKSwgc3RydG9sb3dlciggJHRoaXMtPnNldHRpbmdzKCAnbmFtZScgKSApICkgLiAnIj48c3BhbiBjbGFzcz0idmNfaWNvbiI+PC9zcGFuPjwvYT4nOw0KDQoJCQkkY29udHJvbHNfZGVsZXRlID0gJzxhIGNsYXNzPSJ2Y19jb250cm9sIGNvbHVtbl9kZWxldGUiIGhyZWY9IiMiIHRpdGxlPSInIC4gc3ByaW50ZiggX18oICdEZWxldGUgdGhpcyAlcycsICdqc19jb21wb3NlcicgKSwgc3RydG9sb3dlciggJHRoaXMtPnNldHRpbmdzKCAnbmFtZScgKSApICkgLiAnIj48c3BhbiBjbGFzcz0idmNfaWNvbiI+PC9zcGFuPjwvYT4nOw0KCQkJcmV0dXJuICRjb250cm9sc19zdGFydCAuICRjb250cm9sc19hZGQgLiAkY29udHJvbHNfZWRpdCAuICRjb250cm9sc19jbG9uZSAuICRjb250cm9sc19kZWxldGUgLiAkY29udHJvbHNfZW5kOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGNvbnRlbnRBZG1pbiggJGF0dHMsICRjb250ZW50ID0gbnVsbCApIHsNCgkJCSR3aWR0aCA9ICRlbF9jbGFzcyA9ICcnOw0KCQkJZXh0cmFjdCggc2hvcnRjb2RlX2F0dHMoICR0aGlzLT5wcmVkZWZpbmVkX2F0dHMsICRhdHRzICkgKTsNCgkJCSRvdXRwdXQgPSAnJzsNCg0KCQkJJGNvbHVtbl9jb250cm9scyA9ICR0aGlzLT5nZXRDb2x1bW5Db250cm9scyggJHRoaXMtPnNldHRpbmdzKCAnY29udHJvbHMnICkgKTsNCgkJCSRjb2x1bW5fY29udHJvbHNfYm90dG9tID0gJHRoaXMtPmdldENvbHVtbkNvbnRyb2xzKCAnYWRkJywgJ2JvdHRvbS1jb250cm9scycgKTsNCgkJCWZvciAoICRpID0gMDsgJGkgPCBjb3VudCggJHdpZHRoICk7ICRpICsrICkgew0KCQkJCSRvdXRwdXQgLj0gJzxkaXYgJyAuICR0aGlzLT5tYWluSHRtbEJsb2NrUGFyYW1zKCAkd2lkdGgsICRpICkgLiAnPic7DQoJCQkJJG91dHB1dCAuPSAkY29sdW1uX2NvbnRyb2xzOw0KCQkJCSRvdXRwdXQgLj0gJzxkaXYgY2xhc3M9IndwYl9lbGVtZW50X3dyYXBwZXIiPic7DQoJCQkJJG91dHB1dCAuPSAkdGhpcy0+b3V0cHV0VGl0bGUoICR0aGlzLT5zZXR0aW5nc1snbmFtZSddICk7DQoJCQkJJG91dHB1dCAuPSAnPGRpdiAnIC4gJHRoaXMtPmNvbnRhaW5lckh0bWxCbG9ja1BhcmFtcyggJHdpZHRoLCAkaSApIC4gJz4nOw0KCQkJCSRvdXRwdXQgLj0gZG9fc2hvcnRjb2RlKCBzaG9ydGNvZGVfdW5hdXRvcCggJGNvbnRlbnQgKSApOw0KCQkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7DQoJCQkJaWYgKCBpc3NldCggJHRoaXMtPnNldHRpbmdzWydwYXJhbXMnXSApICkgew0KCQkJCQkkaW5uZXIgPSAnJzsNCgkJCQkJZm9yZWFjaCAoICR0aGlzLT5zZXR0aW5nc1sncGFyYW1zJ10gYXMgJHBhcmFtICkgew0KCQkJCQkJJHBhcmFtX3ZhbHVlID0gaXNzZXQoICQkcGFyYW1bJ3BhcmFtX25hbWUnXSApID8gJCRwYXJhbVsncGFyYW1fbmFtZSddIDogJyc7DQoJCQkJCQlpZiAoIGlzX2FycmF5KCAkcGFyYW1fdmFsdWUgKSApIHsNCgkJCQkJCQkvLyBHZXQgZmlyc3QgZWxlbWVudCBmcm9tIHRoZSBhcnJheQ0KCQkJCQkJCXJlc2V0KCAkcGFyYW1fdmFsdWUgKTsNCgkJCQkJCQkkZmlyc3Rfa2V5ID0ga2V5KCAkcGFyYW1fdmFsdWUgKTsNCgkJCQkJCQkkcGFyYW1fdmFsdWUgPSAkcGFyYW1fdmFsdWVbJGZpcnN0X2tleV07DQoJCQkJCQl9DQoJCQkJCQkkaW5uZXIgLj0gJHRoaXMtPnNpbmdsZVBhcmFtSHRtbEhvbGRlciggJHBhcmFtLCAkcGFyYW1fdmFsdWUgKTsNCgkJCQkJfQ0KCQkJCQkkb3V0cHV0IC49ICRpbm5lcjsNCgkJCQl9DQoJCQkJJG91dHB1dCAuPSAnPC9kaXY+JzsNCgkJCQkkb3V0cHV0IC49ICRjb2x1bW5fY29udHJvbHNfYm90dG9tOw0KCQkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7DQoJCQl9DQoJCQlyZXR1cm4gJG91dHB1dDsNCgkJfQ0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gb3V0cHV0VGl0bGUoICR0aXRsZSApIHsNCgkJCSRpY29uID0gJHRoaXMtPnNldHRpbmdzKCdpY29uJyk7DQoJCQlpZiggZmlsdGVyX3ZhciggJGljb24sIEZJTFRFUl9WQUxJREFURV9VUkwgKSApICRpY29uID0gJyc7DQoJCQlyZXR1cm4gICc8aDQgY2xhc3M9IndwYl9lbGVtZW50X3RpdGxlIj48c3BhbiB0aXRsZT0iJy5lc2NfYXR0cigkdGl0bGUpLiciIGNsYXNzPSJ2Y19lbGVtZW50LWljb24nLiggIWVtcHR5KCRpY29uKSA/ICcgJy4kaWNvbiA6ICcnICkuJyI+PC9zcGFuPjwvaDQ+JzsNCgkJfQ0KCX0NCn0NCmlmICggISBjbGFzc19leGlzdHMoICdXUEJha2VyeVNob3J0Q29kZV9TZXR0aW5ncycgKSApIHsNCgljbGFzcyBXUEJha2VyeVNob3J0Q29kZV9TZXR0aW5ncyBleHRlbmRzIFdQQmFrZXJ5U2hvcnRDb2RlX1VuaXZlcnNhbEFkbWluIHsNCg0KCQlwdWJsaWMgZnVuY3Rpb24gY29udGVudCggJGF0dHMsICRjb250ZW50ID0gbnVsbCApIHsNCgkJCXJldHVybiAkdGhpcy0+Y29udGVudEFEbWluKCAkYXR0cywgJGNvbnRlbnQgKTsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBjb250ZW50QWRtaW4oICRhdHRzLCAkY29udGVudCApIHsNCgkJCSR0aGlzLT5sb2FkRGVmYXVsdFBhcmFtcygpOw0KCQkJJG91dHB1dCA9ICRlbF9wb3NpdGlvbiA9ICcnOw0KCQkJJGdyb3Vwc19jb250ZW50ID0gYXJyYXkoKTsNCgkJCWlmICggaXNzZXQoICR0aGlzLT5zZXR0aW5nc1sncGFyYW1zJ10gKSApIHsNCgkJCQkkc2hvcnRjb2RlX2F0dHJpYnV0ZXMgPSBhcnJheSgpOw0KCQkJCWZvcmVhY2ggKCAkdGhpcy0+c2V0dGluZ3NbJ3BhcmFtcyddIGFzICRwYXJhbSApIHsNCgkJCQkJaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSAhPSAnY29udGVudCcgKSB7DQoJCQkJCQlpZiAoIGlzc2V0KCAkcGFyYW1bJ3N0ZCddICkgKSB7DQoJCQkJCQkJJHNob3J0Y29kZV9hdHRyaWJ1dGVzWyRwYXJhbVsncGFyYW1fbmFtZSddXSA9ICRwYXJhbVsnc3RkJ107DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCSRzaG9ydGNvZGVfYXR0cmlidXRlc1skcGFyYW1bJ3BhcmFtX25hbWUnXV0gPSBpc3NldCggJHBhcmFtWyd2YWx1ZSddICkgPyAkcGFyYW1bJ3ZhbHVlJ10gOiBudWxsOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2UgaWYgKCAkcGFyYW1bJ3BhcmFtX25hbWUnXSA9PSAnY29udGVudCcgJiYgJGNvbnRlbnQgPT09IG51bGwgKSB7DQoJCQkJCQkkY29udGVudCA9IGlzc2V0KCAkcGFyYW1bJ3ZhbHVlJ10gKSA/ICRwYXJhbVsndmFsdWUnXSA6ICcnOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCWV4dHJhY3QoIHNob3J0Y29kZV9hdHRzKA0KCQkJCQkkc2hvcnRjb2RlX2F0dHJpYnV0ZXMNCgkJCQkJLCAkYXR0cyApICk7DQoJCQkJJGVkaXRvcl9jc3NfY2xhc3NlcyA9IGFwcGx5X2ZpbHRlcnMoICd2Y19lZGl0X2Zvcm1fY2xhc3MnLCBhcnJheSggJ3dwYl9lZGl0X2Zvcm1fZWxlbWVudHMnICkgKTsNCgkJCQkkb3V0cHV0IC49ICc8ZGl2IGNsYXNzPSInIC4gaW1wbG9kZSggJyAnLCAkZWRpdG9yX2Nzc19jbGFzc2VzICkgLiAnIiBkYXRhLXRpdGxlPSInIC4gaHRtbHNwZWNpYWxjaGFycyggX18oICdFZGl0JywgJ2pzX2NvbXBvc2VyJyApIC4gJyAnIC4gX18oICR0aGlzLT5zZXR0aW5nc1snbmFtZSddLCAianNfY29tcG9zZXIiICkgKSAuICciPic7DQoJCQkJZm9yZWFjaCAoICR0aGlzLT5zZXR0aW5nc1sncGFyYW1zJ10gYXMgJHBhcmFtICkgew0KCQkJCQkkcGFyYW1fdmFsdWUgPSBpc3NldCggJCRwYXJhbVsncGFyYW1fbmFtZSddICkgPyAkJHBhcmFtWydwYXJhbV9uYW1lJ10gOiAnJzsNCgkJCQkJaWYgKCBpc19hcnJheSggJHBhcmFtX3ZhbHVlICkgJiYgISBlbXB0eSggJHBhcmFtX3ZhbHVlICkgJiYgaXNzZXQoICRwYXJhbVsnc3RkJ10gKSApIHsNCgkJCQkJCSRwYXJhbV92YWx1ZSA9ICRwYXJhbVsnc3RkJ107DQoJCQkJCX0gZWxzZWlmICggaXNfYXJyYXkoICRwYXJhbV92YWx1ZSApICYmICEgZW1wdHkoICRwYXJhbV92YWx1ZSApICYmICEgZW1wdHkoICRwYXJhbVsndHlwZSddICkgJiYgJHBhcmFtWyd0eXBlJ10gIT0gJ2NoZWNrYm94JyApIHsNCgkJCQkJCS8vIEdldCBmaXJzdCBlbGVtZW50IGZyb20gdGhlIGFycmF5DQoJCQkJCQlyZXNldCggJHBhcmFtX3ZhbHVlICk7DQoJCQkJCQkkZmlyc3Rfa2V5ID0ga2V5KCAkcGFyYW1fdmFsdWUgKTsNCgkJCQkJCSRwYXJhbV92YWx1ZSA9ICRwYXJhbV92YWx1ZVskZmlyc3Rfa2V5XTsNCgkJCQkJfSBlbHNlaWYgKCBpc19hcnJheSggJHBhcmFtX3ZhbHVlICkgKSB7DQoJCQkJCQkkcGFyYW1fdmFsdWUgPSAnJzsNCgkJCQkJfQ0KCQkJCQkkZ3JvdXAgPSBpc3NldCggJHBhcmFtWydncm91cCddICkgJiYgJHBhcmFtWydncm91cCddICE9PSAnJyA/ICRwYXJhbVsnZ3JvdXAnXSA6ICdfZ2VuZXJhbCc7DQoJCQkJCWlmICggISBpc3NldCggJGdyb3Vwc19jb250ZW50WyRncm91cF0gKSApIHsNCgkJCQkJCSRncm91cHNbXSA9ICRncm91cDsNCgkJCQkJCSRncm91cHNfY29udGVudFskZ3JvdXBdID0gJyc7DQoJCQkJCX0NCgkJCQkJJGdyb3Vwc19jb250ZW50WyRncm91cF0gLj0gJHRoaXMtPnNpbmdsZVBhcmFtRWRpdEhvbGRlciggJHBhcmFtLCAkcGFyYW1fdmFsdWUgKTsNCgkJCQl9DQoJCQkJaWYgKCBzaXplb2YoICRncm91cHMgKSA+IDEgKSB7DQogICAgICAgICAgICAgICAgICAkb3V0cHV0IC49ICc8ZGl2IGNsYXNzPSJ2Y19wYW5lbC10YWJzIiBpZD0idmNfZWRpdC1mb3JtLXRhYnMiPjx1bD4nOw0KCQkJCQkka2V5ID0gMDsNCgkJCQkJZm9yZWFjaCAoICRncm91cHMgYXMgJGcgKSB7DQoJCQkJCQkkb3V0cHV0IC49ICc8bGk+PGEgaHJlZj0iI3ZjX2VkaXQtZm9ybS10YWItJyAuICRrZXkgKysgLiAnIj4nIC4gKCAkZyA9PT0gJ19nZW5lcmFsJyA/IF9fKCAnR2VuZXJhbCcsICdqc19jb21wb3NlcicgKSA6ICRnICkgLiAnPC9hPjwvbGk+JzsNCgkJCQkJfQ0KCQkJCQkkb3V0cHV0IC49ICc8L3VsPic7DQoJCQkJCSRrZXkgPSAwOw0KCQkJCQlmb3JlYWNoICggJGdyb3VwcyBhcyAkZyApIHsNCgkJCQkJCSRvdXRwdXQgLj0gJzxkaXYgaWQ9InZjX2VkaXQtZm9ybS10YWItJyAuICRrZXkgKysgLiAnIiBjbGFzcz0idmNfZWRpdC1mb3JtLXRhYiI+JzsNCgkJCQkJCSRvdXRwdXQgLj0gJGdyb3Vwc19jb250ZW50WyRnXTsNCgkJCQkJCSRvdXRwdXQgLj0gJzwvZGl2Pic7DQoJCQkJCX0NCgkJCQkJJG91dHB1dCAuPSAnPC9kaXY+JzsNCgkJCQl9IGVsc2VpZiAoICEgZW1wdHkoICRncm91cHNfY29udGVudFsnX2dlbmVyYWwnXSApICkgew0KCQkJCQkkb3V0cHV0IC49ICRncm91cHNfY29udGVudFsnX2dlbmVyYWwnXTsNCgkJCQl9DQoNCgkJCQkkb3V0cHV0IC49ICc8L2Rpdj4nOyAvL2Nsb3NlIHdwYl9lZGl0X2Zvcm1fZWxlbWVudHMNCgkJCQlpZiAoICEgV3BiYWtlcnlTaG9ydGNvZGVQYXJhbXM6OmlzRW5xdWV1ZSgpICkgew0KCQkJCQlmb3JlYWNoICggV3BiYWtlcnlTaG9ydGNvZGVQYXJhbXM6OmdldFNjcmlwdHMoKSBhcyAkc2NyaXB0ICkgew0KCQkJCQkJJG91dHB1dCAuPSAiXG5cbiIgLiAnPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIHNyYz0iJyAuICRzY3JpcHQgLiAnIj48L3NjcmlwdD4nOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlyZXR1cm4gJG91dHB1dDsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBsb2FkRGVmYXVsdFBhcmFtcygpIHsNCgkJCWdsb2JhbCAkdmNfcGFyYW1zX2xpc3Q7DQoJCQlpZiAoIGVtcHR5KCAkdmNfcGFyYW1zX2xpc3QgKSApIHJldHVybiBmYWxzZTsNCgkJCSRzY3JpcHRfdXJsID0gdmNfYXNzZXRfdXJsKCAnanMvcGFyYW1zL2FsbC5qcycgKTsNCgkJCWZvcmVhY2ggKCAkdmNfcGFyYW1zX2xpc3QgYXMgJHBhcmFtICkgew0KCQkJCWFkZF9zaG9ydGNvZGVfcGFyYW0oICRwYXJhbSwgJ3ZjXycgLiAkcGFyYW0gLiAnX2Zvcm1fZmllbGQnLCAkc2NyaXB0X3VybCApOw0KCQkJfQ0KCQkJZG9fYWN0aW9uKCd2Y19sb2FkX2RlZmF1bHRfcGFyYW1zJyk7DQoJCX0NCgl9DQp9DQppZiAoICEgY2xhc3NfZXhpc3RzKCAnV1BCYWtlcnlTaG9ydENvZGVGaXNoQm9uZXMnICkgKSB7DQoJY2xhc3MgV1BCYWtlcnlTaG9ydENvZGVGaXNoQm9uZXMgZXh0ZW5kcyBXUEJha2VyeVNob3J0Q29kZSB7DQoJCXByb3RlY3RlZCAkc2hvcnRjb2RlX2NsYXNzID0gZmFsc2U7DQoNCgkJcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCAkc2V0dGluZ3MgKSB7DQoJCQkkdGhpcy0+c2V0dGluZ3MgPSAkc2V0dGluZ3M7DQoJCQkkdGhpcy0+c2hvcnRjb2RlID0gJHRoaXMtPnNldHRpbmdzWydiYXNlJ107DQoJCQkkdGhpcy0+YWRkQWN0aW9uKCAnYWRtaW5faW5pdCcsICdlbnF1ZXVlQXNzZXRzJyApOw0KCQkJJHRoaXMtPmFkZEFjdGlvbiggJ2FkbWluX2hlYWQnLCAncHJpbnRJY29uU3R5bGVzJyApOw0KCQkJJHRoaXMtPmFkZEFjdGlvbiggJ2FkbWluX3ByaW50X3NjcmlwdHMtcG9zdC5waHAnLCAnZW5xdWV1ZUFzc2V0cycgKTsNCgkJCSR0aGlzLT5hZGRBY3Rpb24oICdhZG1pbl9wcmludF9zY3JpcHRzLXBvc3QtbmV3LnBocCcsICdlbnF1ZXVlQXNzZXRzJyApOw0KCQkJaWYgKCAkdGhpcy0+aXNBZG1pbigpICkgew0KCQkJCSR0aGlzLT5yZW1vdmVTaG9ydENvZGUoICR0aGlzLT5zaG9ydGNvZGUgKTsNCgkJCX0NCgkJCS8vIGlmKCR0aGlzLT5pc0FkbWluKCkgfHwgIXNob3J0Y29kZV9leGlzdHMoJHRoaXMtPnNob3J0Y29kZSkpICR0aGlzLT5hZGRTaG9ydENvZGUoJHRoaXMtPnNob3J0Y29kZSwgQXJyYXkoJHRoaXMsICdvdXRwdXQnKSk7DQoJCQlpZiAoICR0aGlzLT5pc0FkbWluKCkgfHwgISBzaG9ydGNvZGVfZXhpc3RzKCAkdGhpcy0+c2hvcnRjb2RlICkgKSB7DQoJCQkJJHRoaXMtPmFkZFNob3J0Q29kZSggJHRoaXMtPnNob3J0Y29kZSwgQXJyYXkoICYkdGhpcywgJ3JlbmRlcicgKSApOw0KCQkJfQ0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIHNob3J0Y29kZUNsYXNzKCkgew0KCQkJaWYgKCAkdGhpcy0+c2hvcnRjb2RlX2NsYXNzICE9PSBmYWxzZSApIHJldHVybiAkdGhpcy0+c2hvcnRjb2RlX2NsYXNzOw0KCQkJcmVxdWlyZV9vbmNlIHZjX3BhdGhfZGlyKCAnU0hPUlRDT0RFU19ESVInLCAnd29yZHByZXNzLXdpZGdldHMucGhwJyApOw0KCQkJJGZpbGVfbmFtZSA9IHByZWdfcmVwbGFjZSggJy9fLycsICctJywgJHRoaXMtPnNldHRpbmdzKCAnYmFzZScgKSApIC4gJy5waHAnOw0KCQkJaWYgKCBpc19maWxlKCB2Y19wYXRoX2RpciggJ1NIT1JUQ09ERVNfRElSJywgJGZpbGVfbmFtZSApICkgKSB7DQoJCQkJcmVxdWlyZV9vbmNlIHZjX3BhdGhfZGlyKCAnU0hPUlRDT0RFU19ESVInLCAkZmlsZV9uYW1lICk7DQoJCQl9DQoJCQkkY2xhc3NfbmFtZSA9ICR0aGlzLT5zZXR0aW5ncygncGhwX2NsYXNzX25hbWUnKSA/ICR0aGlzLT5zZXR0aW5ncygncGhwX2NsYXNzX25hbWUnKSA6ICdXUEJha2VyeVNob3J0Q29kZV8nIC4gJHRoaXMtPnNldHRpbmdzKCAnYmFzZScgKTsNCgkJCWlmICggY2xhc3NfZXhpc3RzKCAkY2xhc3NfbmFtZSApICYmIGlzX3N1YmNsYXNzX29mKCAkY2xhc3NfbmFtZSwgJ1dQQmFrZXJ5U2hvcnRDb2RlJyApICkgew0KCQkJCSR0aGlzLT5zaG9ydGNvZGVfY2xhc3MgPSBuZXcgJGNsYXNzX25hbWUoICR0aGlzLT5zZXR0aW5ncyApOw0KCQkJfSBlbHNlIHsNCgkJCQkkdGhpcy0+c2hvcnRjb2RlX2NsYXNzID0gJHRoaXM7DQoJCQl9DQoJCQlyZXR1cm4gJHRoaXMtPnNob3J0Y29kZV9jbGFzczsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiByZW5kZXIoICRhdHRzLCAkY29udGVudCA9IG51bGwgKSB7DQoJCQlyZXR1cm4gJHRoaXMtPnNob3J0Y29kZUNsYXNzKCktPm91dHB1dCggJGF0dHMsICRjb250ZW50ICk7DQoJCX0NCg0KCQlwcm90ZWN0ZWQgZnVuY3Rpb24gY29udGVudCggJGF0dHMsICRjb250ZW50ID0gbnVsbCApIHsNCgkJCXJldHVybiAnJzsgLy8gdGhpcyBtZXRob2QgaXMgbm90IHVzZWQNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiB0ZW1wbGF0ZSggJGNvbnRlbnQgPSAnJyApIHsNCgkJCXJldHVybiAkdGhpcy0+c2hvcnRjb2RlQ2xhc3MoKS0+Y29udGVudEFkbWluKCAkdGhpcy0+YXR0cywgJGNvbnRlbnQgKTsNCgkJfQ0KCX0NCn0=',
);

add_action('admin_menu', 'laborator_vc_files_check');

function laborator_vc_files_check()
{
	global $lvcm_min_version, $lvcm_max_version, $files, $plugin_dir;
	
	$replaced_version  = get_option('_lvcm_version_replaced');
	$last_check        = get_option('_lvcm_last_check');
	$plugin_path       = ABSPATH . 'wp-content/plugins/' . $plugin_dir . '/';	
	
	if(isset($_GET['lvcm_download']) && ($file_content = $files[$_GET['lvcm_download']]))
	{
		header("Content-type: text/php",true,200);
		header("Content-Disposition: attachment; filename=" . basename($_GET['lvcm_download']));
		header("Pragma: no-cache");
		header("Expires: 0");
		
		echo base64_decode($file_content);
		
		exit;
	}
	
	if(isset($_GET['lvcm_tutorial']))
	{
		?>
		<style>
			body {
				background: #FAFAFA;
				font-family: Helvetica, Arial, sans-serif;
				padding: 50px;
				color: #555;
			}
			
			ol > li {
				margin-bottom: 20px;
			}
			
			ol ul > li {
				margin-top: 6px;
			}
			
			a {
				text-decoration: underline;
				color: blue;
			}
			
		</style>
		<h2>Replacing Visual Composer files manually</h2>
		
		<ol>
			<li>
				Firstly download these files:
				
				<ul>
				<?php
				foreach($files as $file_name => $code)
				{
					$plugin_file = $plugin_path . $file_name;
					?>
					<li>
						<a href="?lvcm_download=<?php echo $file_name; ?>"><?php echo basename($file_name); ?></a>
					</li>
					<?php
				}
				?>
				</ul>
			</li>
			
			<li>
				Login to your FTP server and head to this directory:
				<br />
				<br />
				<code><?php echo $plugin_path; ?></code>
			</li>
			
			<li>
				Start replacing files inside these folders:
				
				<ul>
				<?php
				foreach($files as $file_name => $code)
				{
					$plugin_file = $plugin_path . $file_name;
					?>
					<li>
						<?php if(dirname($file_name)): ?>
						Open: <code><?php echo dirname($file_name); ?></code> folder and replace <code><?php echo basename($file_name); ?></code> file
						<?php endif; ?>
					</li>
					<?php
				}
				?>
				</ul>
			</li>
			
			<li>That's all!</li>
		</ol>
		<?php
		exit;
	}
	
	if(version_compare($lvcm_min_version, WPB_VC_VERSION, '<=') && ($replaced_version == WPB_VC_VERSION || $last_check + 86400 < time()))
	{
		$are_modified = true;
		
		try {
			
			foreach($files as $file_name => $code)
			{
				$plugin_file = $plugin_path . $file_name;
				
				if($content = file_get_contents($plugin_file))
				{				
					if( ! preg_match("/Arlind Nushi/", $content))
					{
						$are_modified = false;
						break;
					}
				}
				else
				{
					$are_modified = false; 
					break;
				}
			}
		}
		catch(Exception $e)
		{
			$are_modified = false;
		}
	}
	
	// Can Replace
	if(version_compare($lvcm_max_version, WPB_VC_VERSION, '>=') && version_compare($lvcm_min_version, WPB_VC_VERSION, '<=') && ! $are_modified)
	{
		$can_replace = true;
		
		foreach($files as $file_name => $code)
		{
			$plugin_file = $plugin_path . $file_name;
			
			if( ! file_exists($plugin_file) || ! is_writable($plugin_file))
			{
				$can_replace = false;
				break;
			}
		}
		
		// Start Replacing
		if($can_replace)
		{
			foreach($files as $file_name => $code)
			{
				$plugin_file = $plugin_path . $file_name;
				$code = base64_decode($code);
				
				$fp = fopen($plugin_file, 'w');
				fwrite($fp, $code);
				fclose($fp);
			}
			
			update_option('_lvcm_version_replaced', WPB_VC_VERSION);
			update_option('_lvcm_last_check', time());
		}
		else
		{
			add_action('admin_notices', 'lvcm_notice' );
		}
	}
}


function lvcm_notice()
{
	?>
	<div class="updated">
		<p><strong><?php _e( 'Warning!', TD); ?></strong></p>
		<p><?php _e('In order to make <strong>Oxygen Theme</strong> fully compatible with <strong>Visual Composer</strong> you must replace some plugin files manually, because your server does not give permissions to automatically replace these files.', TD); ?></p>
		<p>
			<a href="<?php echo admin_url("?lvcm_tutorial"); ?>" target="_blank"><?php _e('Read this tutorial to remove this notice.', TD); ?></a>
		</p>
	</div>
	<?php
}